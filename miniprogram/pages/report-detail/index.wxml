<!--pages/report-detail/index.wxml-->
<view class="container">
  <!-- åŠ è½½çŠ¶æ€ -->
  <view wx:if="{{loading}}" class="loading-container">
    <view class="loading-spinner"></view>
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>

  <!-- ä¸»è¦å†…å®¹ -->
  <view wx:else class="content">
    <!-- æŠ¥å‘Šå¤´éƒ¨ä¿¡æ¯ -->
    <view class="report-header">
      <view class="header-main">
        <view class="report-title">
          <text class="title-text">{{reportData.reportTypeName}}</text>
          <text class="date-text">{{reportData.formattedDate}}</text>
        </view>
        <view class="header-actions">
          <view class="action-btn" bindtap="onEditReport">
            <text class="action-icon">âœï¸</text>
          </view>
          <view class="action-btn" bindtap="onDeleteReport">
            <text class="action-icon">ğŸ—‘ï¸</text>
          </view>
          <view class="action-btn" bindtap="onCopyReport">
            <text class="action-icon">ğŸ“‹</text>
          </view>
        </view>
      </view>
      
      <!-- æŠ¥å‘Šæ‘˜è¦ -->
      <view class="report-summary">
        <view class="summary-item">
          <text class="summary-number">{{reportSummary.filledCount}}/{{reportSummary.totalCount}}</text>
          <text class="summary-label">å·²å¡«å†™</text>
        </view>
        <view class="summary-divider"></view>
        <view class="summary-item">
          <text class="summary-number normal">{{reportSummary.normalCount}}</text>
          <text class="summary-label">æ­£å¸¸</text>
        </view>
        <view class="summary-divider"></view>
        <view class="summary-item">
          <text class="summary-number abnormal">{{reportSummary.abnormalCount}}</text>
          <text class="summary-label">å¼‚å¸¸</text>
        </view>
        <view class="summary-divider"></view>
        <view class="summary-item">
          <text class="summary-number rate">{{reportSummary.normalRate}}%</text>
          <text class="summary-label">æ­£å¸¸ç‡</text>
        </view>
      </view>

      <!-- æ•´ä½“çŠ¶æ€ -->
      <view class="overall-status {{reportSummary.abnormalCount > 0 ? 'abnormal' : 'normal'}}">
          {{reportSummary.abnormalCount > 0 ? 'å­˜åœ¨å¼‚å¸¸æŒ‡æ ‡ï¼Œè¯·æ³¨æ„' : 'æ‰€æœ‰æŒ‡æ ‡æ­£å¸¸'}}
      </view>
    </view>

    <!-- æŒ‡æ ‡è¯¦æƒ…åˆ—è¡¨ -->
    <view class="indicators-section">
      <text class="section-title">æŒ‡æ ‡è¯¦æƒ…</text>
      
      <view class="indicators-list">
        <view wx:for="{{indicatorConfigs}}" wx:key="key" class="indicator-detail">
          <!-- æ˜¾ç¤ºæ‰€æœ‰æŒ‡æ ‡ï¼ŒåŒ…æ‹¬æ²¡æœ‰æ•°æ®çš„ -->
          <view class="indicator-item">
            <!-- æŒ‡æ ‡å¤´éƒ¨ -->
            <view class="indicator-header">
              <view class="indicator-info">
                <text class="indicator-name">{{item.name}}</text>
                <text class="indicator-abbr">({{item.abbr}})</text>
              </view>
              
              <!-- çŠ¶æ€æ ‡è¯† -->
              <view wx:if="{{reportData.indicators[item.key]}}" class="status-badge {{reportData.indicators[item.key].status}}">
                  {{reportData.indicators[item.key].status === 'normal' ? 'âœ“' : 
                    reportData.indicators[item.key].status === 'high' ? 'â†‘' : 
                    reportData.indicators[item.key].status === 'low' ? 'â†“' : '?'}}
                  {{reportData.indicators[item.key].status === 'normal' ? 'æ­£å¸¸' : 
                    reportData.indicators[item.key].status === 'high' ? 'åé«˜' : 
                    reportData.indicators[item.key].status === 'low' ? 'åä½' : 'æœªçŸ¥'}}
              </view>
              <view wx:else class="status-badge empty">
                  - æœªå¡«å†™
              </view>
            </view>

            <!-- æŒ‡æ ‡æ•°å€¼ -->
            <view class="indicator-values">
              <view class="value-row main-value">
                <text class="value-label">æ£€æµ‹å€¼ï¼š</text>
                <text wx:if="{{reportData.indicators[item.key]}}" class="value-text {{reportData.indicators[item.key].status}}">
                  {{reportData.indicators[item.key].value}}
                </text>
                <text wx:else class="value-text empty">
                  - æœªå¡«å†™
                </text>
              </view>

              <!-- å‚è€ƒèŒƒå›´ï¼ˆéæ¯”å€¼æŒ‡æ ‡æˆ–å…è®¸èŒƒå›´è¾“å…¥çš„æ¯”å€¼æŒ‡æ ‡ï¼‰ -->
              <view wx:if="{{(!item.isRatio || item.allowRangeInput) && reportData.indicators[item.key] && reportData.indicators[item.key].minRange}}" class="value-row">
                <text class="value-label">å‚è€ƒèŒƒå›´ï¼š</text>
                <text class="value-text">
                  {{reportData.indicators[item.key].minRange}} - {{reportData.indicators[item.key].maxRange}}
                </text>
              </view>

              <!-- æœ€ä¼˜èŒƒå›´ï¼ˆæ°¨åŸºé…¸æŒ‡æ ‡ï¼‰ -->
              <view wx:if="{{reportData.indicators[item.key] && reportData.indicators[item.key].optimalRange}}" class="value-row optimal">
                <text class="value-label">æœ€ä¼˜èŒƒå›´ï¼š</text>
                <text class="value-text optimal">
                  {{reportData.indicators[item.key].optimalRange.min}} - {{reportData.indicators[item.key].optimalRange.max}}
                </text>
              </view>
            </view>

            <!-- è¶‹åŠ¿æŒ‰é’®ï¼ˆé¢„ç•™ï¼‰ -->
            <view class="indicator-actions">
              <button class="trend-btn" bindtap="onViewTrend" data-indicator="{{item.key}}">
                <text class="trend-text">ğŸ“ˆ æŸ¥çœ‹è¶‹åŠ¿</text>
              </button>
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- æŠ¥å‘Šä¿¡æ¯ -->
    <view class="report-info-section">
      <text class="section-title">æŠ¥å‘Šä¿¡æ¯</text>
      
      <view class="info-card">
        <view class="info-row">
          <text class="info-label">æŠ¥å‘Šç¼–å·ï¼š</text>
          <text class="info-value">{{reportData.reportId}}</text>
        </view>
        
        <view class="info-row">
          <text class="info-label">æ›´æ–°æ—¶é—´ï¼š</text>
          <text class="info-value">{{reportData.formattedUpdatedAt}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- åº•éƒ¨æ“ä½œæŒ‰é’® -->
  <view class="bottom-actions">
    <button class="action-button edit" bindtap="onEditReport">
      <text class="btn-text">ç¼–è¾‘æŠ¥å‘Š</text>
    </button>
    <button class="action-button delete" bindtap="onDeleteReport" disabled="{{deleting}}">
      <text class="btn-text">{{deleting ? 'åˆ é™¤ä¸­...' : 'åˆ é™¤æŠ¥å‘Š'}}</text>
    </button>
  </view>
</view> 