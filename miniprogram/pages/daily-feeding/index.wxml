<view class="container">
  <!-- ç‚¹å‡»ç©ºç™½å¤„å…³é—­èœå•çš„è¦†ç›–å±‚ -->
  <view class="menu-overlay" wx:if="{{activeFeedingMenu !== -1}}" bindtap="onTapPage"></view>

  <!-- Baby Info Section -->
  <view class="section baby-info-section">
    <view class="baby-name">{{babyName}}</view>
    <view class="baby-date">{{todayDate}}</view>
    <view class="baby-days">å·²å‡ºç”Ÿ {{babyDays}} å¤©</view>
  </view>

  <!-- Weight Section -->
  <view class="section weight-section">
    <text class="section-title">ä»Šæ—¥ä½“é‡ (kg)</text>
    <input type="digit" class="weight-input" value="{{weight}}" placeholder="è¯·è¾“å…¥ä½“é‡" bindinput="onWeightInput" />
  </view>

  <!-- Protein Calculations Section -->
  <view class="section protein-section">
    <view class="calculation-header">
      <text class="header-label">å¤©ç„¶è›‹ç™½æ¥æº: {{proteinSourceLabel}}</text>
    </view>
    
    <!-- è¥å…»è®¾ç½®å¼•å¯¼æç¤º -->
    <view class="settings-guide" wx:if="{{showSettingsGuide}}">
      <view class="guide-icon">
        <image src="/images/icons/warning.svg" mode="aspectFit"></image>
      </view>
      <view class="guide-content">
        <text class="guide-title">è¥å…»å‚æ•°è®¾ç½®ä¸å®Œæ•´</text>
        <text class="guide-desc">{{settingsGuideText || 'æ‚¨éœ€è¦å…ˆå®Œæˆå¿…è¦çš„è¥å…»å‚æ•°è®¾ç½®æ‰èƒ½å‡†ç¡®è®¡ç®—å–‚å…»é‡'}}</text>
        <view class="missing-items">
          <text wx:for="{{missingSettings}}" wx:key="*this" class="missing-item">{{item}}</text>
        </view>
      </view>
      <button class="guide-btn" bindtap="navigateToNutritionSettings">å»è®¾ç½®</button>
    </view>
    
    <view class="calculation-items" wx:if="{{!showSettingsGuide}}">
      <view class="calculation-item">
        <text class="label">å½“å¤©æ‰€éœ€å¤©ç„¶è›‹ç™½</text>
        <text class="value">{{dailyNaturalProtein}}g</text>
      </view>
      <view class="calculation-item">
        <text class="label">å½“å¤©æ‰€éœ€{{proteinSourceLabel}}é‡</text>
        <text class="value">{{requiredNaturalMilk}}ml</text>
      </view>
      <!-- å¥¶ç²‰æƒ…å†µä¸‹ï¼Œæ˜¾ç¤ºæ‰€éœ€å¥¶ç²‰é‡ -->
      <view class="calculation-item" wx:if="{{proteinSourceType === 'formulaMilk' && formulaPowderNeeded}}">
        <text class="label">å½“å¤©æ‰€éœ€å¥¶ç²‰é‡</text>
        <text class="value">{{formulaPowderNeeded}}g</text>
      </view>
      <view class="calculation-item">
        <text class="label">å½“å¤©å·²å–‚{{proteinSourceLabel}}æ€»é‡</text>
        <text class="value">{{totalNaturalMilkFed}}ml</text>
      </view>
      <view class="calculation-item">
        <text class="label">å½“å¤©å‰©ä½™{{proteinSourceLabel}}é‡</text>
        <text class="value">{{remainingNaturalMilk}}ml</text>
      </view>
    </view>
  </view>

  <!-- Current Feeding Section -->
  <view class="section feeding-section">
    <!-- æ ‡é¢˜æ å¸¦æœ‰å¿«æ·è®°å½•æŒ‰é’® -->
    <view class="section-header">
      <text class="section-title">å–‚å¥¶</text>
      <view class="quick-record-btn" bindtap="showQuickInputModal">
        <text>å¿«æ·è®°å½•</text>
      </view>
    </view>
    
    <!-- æœªå¼€å§‹å–‚å¥¶çŠ¶æ€ï¼šå…ˆè¾“å…¥å¥¶é‡ -->
    <view class="feeding-inputs" wx:if="{{!currentFeeding.startTime}}">
      <!-- å¤©ç„¶å¥¶é‡ -->
      <view class="input-group">
        <text class="label">{{proteinSourceLabel}}é‡</text>
        <view class="volume-control">
          <button class="volume-btn decrease" catchtap="decreaseVolume" data-field="naturalMilkVolume">âˆ’</button>
          <input type="digit" class="volume-input" value="{{currentFeeding.naturalMilkVolume}}" 
                data-field="naturalMilkVolume" bindinput="onFeedingInput" />
          <button class="volume-btn increase" catchtap="increaseVolume" data-field="naturalMilkVolume">+</button>
          <text class="volume-unit">ml</text>
        </view>
      </view>
      
      <!-- æ™®é€šå¥¶ç²‰æ¨¡å¼ä¸‹æ˜¾ç¤ºå¥¶ç²‰å…‹é‡ -->
      <view class="input-group" wx:if="{{proteinSourceType === 'formulaMilk'}}">
        <text class="label">å¥¶ç²‰å…‹é‡</text>
        <view class="volume-control">
          <text class="volume-input lh-80">{{currentFeeding.formulaPowderWeight || '0'}}</text>
          <text class="volume-unit">g</text>
        </view>
      </view>
      
      <!-- ç‰¹å¥¶é‡ -->
      <view class="input-group">
        <text class="label">ç‰¹å¥¶é‡</text>
        <view class="volume-control">
          <button class="volume-btn decrease" catchtap="decreaseVolume" data-field="specialMilkVolume">âˆ’</button>
          <input type="digit" class="volume-input" value="{{currentFeeding.specialMilkVolume}}" 
                data-field="specialMilkVolume" bindinput="onFeedingInput" />
          <button class="volume-btn increase" catchtap="increaseVolume" data-field="specialMilkVolume">+</button>
          <text class="volume-unit">ml</text>
        </view>
      </view>
      
      <!-- è®¡ç®—ç»“æœæ˜¾ç¤º -->
      <view class="special-milk">
        <view class="special-milk-item">
          <text class="label">æ€»å¥¶é‡:</text>
          <text class="value">{{currentFeeding.totalVolume || '0'}}ml</text>
        </view>
        <view class="special-milk-item">
          <text class="label">ç‰¹å¥¶ç²‰:</text>
          <text class="value">{{currentFeeding.specialMilkPowder || '0'}}g</text>
        </view>
      </view>
      
      <!-- æŒ‰é’®åŒºåŸŸ -->
      <view class="feeding-buttons">
        <button class="start-feeding-btn" bindtap="startFeeding">
          <text class="btn-text">ç«‹å³å¼€å§‹</text>
        </button>
      </view>
    </view>
    
    <!-- æ­£åœ¨å–‚å¥¶çŠ¶æ€ï¼šæ˜¾ç¤ºè®°å½•ä¸­ -->
    <view class="feeding-active" wx:if="{{currentFeeding.startTime && !currentFeeding.endTime}}">
      <view class="feeding-status">
        <view class="status-row">
          <text class="status-label">å¼€å§‹æ—¶é—´:</text>
          <text class="status-value">{{currentFeeding.startTime}}</text>
        </view>
        <view class="status-row">
          <text class="status-label">çŠ¶æ€:</text>
          <text class="status-value highlight">è®°å½•ä¸­...</text>
        </view>
      </view>
      
      <!-- æ˜¾ç¤ºå–‚å¥¶æ•°æ® -->
      <view class="feeding-data">
        <view class="data-row">
          <text class="data-label">{{proteinSourceLabel}}é‡:</text>
          <text class="data-value">{{currentFeeding.naturalMilkVolume}}ml</text>
        </view>
        <!-- æ™®é€šå¥¶ç²‰æƒ…å†µä¸‹æ˜¾ç¤ºå¥¶ç²‰é‡é‡ -->
        <view class="data-row" wx:if="{{proteinSourceType === 'formulaMilk'}}">
          <text class="data-label">å¥¶ç²‰é‡é‡:</text>
          <text class="data-value">{{currentFeeding.formulaPowderWeight || '0'}}g</text>
        </view>
        <view class="data-row">
          <text class="data-label">ç‰¹å¥¶é‡:</text>
          <text class="data-value">{{currentFeeding.specialMilkVolume}}ml</text>
        </view>
        <view class="data-row">
          <text class="data-label">ç‰¹å¥¶ç²‰:</text>
          <text class="data-value">{{currentFeeding.specialMilkPowder}}g</text>
        </view>
        <view class="data-row">
          <text class="data-label">æ€»é‡:</text>
          <text class="data-value">{{currentFeeding.totalVolume}}ml</text>
        </view>
      </view>
      
      <!-- æŒ‰é’®åŒºåŸŸ -->
      <view class="feeding-buttons">
        <!-- æ’¤é”€æŒ‰é’® -->
        <button class="cancel-feeding-btn" bindtap="cancelFeeding">
          <text class="btn-text-secondary">æ’¤é”€</text>
        </button>
        
        <!-- ç»“æŸæŒ‰é’® -->
        <button class="end-feeding-btn" bindtap="endFeeding">
          <text class="btn-text">ç«‹å³ç»“æŸ</text>
        </button>
      </view>
    </view>
  </view>

  <!-- Medication Section -->
  <view class="section medication-section">
    <text class="section-title">å–‚è¯</text>
    <view class="medication-grid">
      <!-- ä½¿ç”¨æ•°æ®åº“åŠ è½½çš„è¯ç‰©åˆ—è¡¨ -->
      <view class="medication-item {{hasTakenMedication(item._id) ? 'active' : ''}}" 
            wx:for="{{medicationsList}}" wx:key="_id"
            data-medication="{{item._id}}" bindtap="openMedicationModal">
        <text>{{item.name}}</text>
        <text class="volume">{{item.dosage}}{{item.unit}}</text>
      </view>
      
      <!-- å¦‚æœæ²¡æœ‰è¯ç‰©ï¼Œæ˜¾ç¤ºæ·»åŠ æç¤º -->
      <view class="no-medications" wx:if="{{!medicationsList || medicationsList.length === 0}}">
        <text>è¯·å…ˆåœ¨"æˆ‘çš„-è¯ç‰©è®¾ç½®"ä¸­æ·»åŠ è¯ç‰©</text>
      </view>
    </view>
  </view>

  <!-- Bowel Movement Section -->
  <view class="section bowel-section">
    <view class="section-header">
      <text class="section-title">æ’ä¾¿è®°å½•</text>
      <view class="bowel-stats">
        <text class="stats-text">ä»Šæ—¥ {{bowelStats.totalCount}} æ¬¡</text>
      </view>
    </view>
    
    <view class="bowel-grid">
      <!-- å¤§ä¾¿æŒ‰é’® -->
      <view class="bowel-item stool" data-type="stool" bindtap="showBowelRecordModal">
        <view class="bowel-icon">ğŸ’©</view>
        <text class="bowel-label">å¤§ä¾¿</text>
        <text class="bowel-count">{{bowelStats.stoolCount}}æ¬¡</text>
      </view>
      
      <!-- å°ä¾¿æŒ‰é’® -->
      <view class="bowel-item urine" data-type="urine" bindtap="showBowelRecordModal">
        <view class="bowel-icon">ğŸ’§</view>
        <text class="bowel-label">å°ä¾¿</text>
        <text class="bowel-count">{{bowelStats.urineCount}}æ¬¡</text>
      </view>
      
      <!-- æ··åˆæŒ‰é’® -->
      <view class="bowel-item mixed" data-type="mixed" bindtap="showBowelRecordModal">
        <view class="bowel-icon">ğŸš½</view>
        <text class="bowel-label">æ··åˆ</text>
        <text class="bowel-count">{{bowelStats.mixedCount}}æ¬¡</text>
      </view>
    </view>
  </view>

  <!-- Records Section -->
  <view class="section records-section">
    <text class="section-title">ä»Šæ—¥æ•°æ®è®°å½•</text>
    
    <!-- é€‰é¡¹å¡æ ‡é¢˜ -->
    <view class="tabs">
      <view class="tab {{activeTab === 'feeding' ? 'active' : ''}}" bindtap="switchTab" data-tab="feeding">
        <text>å–‚å¥¶è®°å½•</text>
      </view>
      <view class="tab {{activeTab === 'medication' ? 'active' : ''}}" bindtap="switchTab" data-tab="medication">
        <text>ç”¨è¯è®°å½•</text>
      </view>
      <view class="tab {{activeTab === 'bowel' ? 'active' : ''}}" bindtap="switchTab" data-tab="bowel">
        <text>æ’ä¾¿è®°å½•</text>
      </view>
    </view>
    
    <!-- å–‚å¥¶è®°å½• -->
    <view class="tab-content" hidden="{{activeTab !== 'feeding'}}">
      <view class="records-list">
        <view class="record-item" wx:for="{{feedings}}" wx:key="index">
          <view class="record-content" bindtap="openEditModal" data-index="{{index}}">
            <view class="record-time">{{item.startTime}} â€“ {{item.endTime}}</view>
            <view class="record-details">
              <view class="record-detail-item">
                <text class="detail-label">{{proteinSourceLabel}}:</text>
                <text class="detail-value">{{item.naturalMilkVolume}}ml</text>
              </view>
              <!-- æ™®é€šå¥¶ç²‰æƒ…å†µä¸‹æ˜¾ç¤ºå¥¶ç²‰é‡é‡ -->
              <view class="record-detail-item" wx:if="{{proteinSourceType === 'formulaMilk'}}">
                <text class="detail-label">å¥¶ç²‰:</text>
                <text class="detail-value">{{item.formulaPowderWeight || '0'}}g</text>
              </view>
              <view class="record-detail-item">
                <text class="detail-label">ç‰¹å¥¶:</text>
                <text class="detail-value">{{item.specialMilkVolume}}ml</text>
              </view>
              <view class="record-detail-item">
                <text class="detail-label">ç‰¹å¥¶ç²‰:</text>
                <text class="detail-value">{{item.specialMilkPowder || '0'}}g</text>
              </view>
              <view class="record-detail-item">
                <text class="detail-label">æ€»é‡:</text>
                <text class="detail-value">{{item.totalVolume}}ml</text>
              </view>
            </view>
          </view>
          <!-- ä¸‰ç‚¹èœå•æŒ‰é’® -->
          <view class="menu-btn" catchtap="toggleFeedingMenu" data-index="{{index}}">
            <view class="dot-menu">
              <view class="dot"></view>
              <view class="dot"></view>
              <view class="dot"></view>
            </view>
          </view>
          
          <!-- èœå•å¼¹å‡ºé€‰é¡¹ -->
          <view class="menu-options {{activeFeedingMenu === index ? 'show' : ''}}" wx:if="{{activeFeedingMenu === index}}">
            <view class="menu-option" catchtap="openEditModal" data-index="{{index}}" data-action="edit">
              <text>ç¼–è¾‘</text>
            </view>
            <view class="menu-option delete" catchtap="deleteFeeding" data-index="{{index}}" data-action="delete">
              <text>åˆ é™¤</text>
            </view>
          </view>
        </view>
        <view class="empty-record" wx:if="{{feedings.length === 0}}">
          <text>æš‚æ— å–‚å¥¶è®°å½•</text>
        </view>
      </view>
    </view>

    <!-- è¯ç‰©è®°å½• -->
    <view class="tab-content" hidden="{{activeTab !== 'medication'}}">
      <view class="medication-records">
        <!-- æŒ‰è¯ç‰©åç§°åˆ†ç»„æ˜¾ç¤º -->
        <view class="medication-group" wx:for="{{groupedMedicationRecords}}" wx:key="medicationName" wx:for-item="group">
          <view class="medication-group-header">
            <text class="medication-group-name">{{group.medicationName}}</text>
            <text class="medication-group-count">ä»Šæ—¥{{group.totalCount}}æ¬¡</text>
          </view>
          
          <!-- è¯¥è¯ç‰©çš„æ‰€æœ‰è®°å½• -->
          <view class="medication-group-records">
            <view class="medication-record-item" wx:for="{{group.records}}" wx:key="originalIndex" wx:for-item="record">
              <view class="record-content" data-index="{{record.originalIndex}}">
                <view class="medication-time-dose">
                  <text class="medication-time">{{record.actualTime}}</text>
                  <text class="medication-volume">{{record.dosage}}{{record.unit}}</text>
                </view>
              </view>
              <!-- æ“ä½œæŒ‰é’® -->
              <view class="action-buttons">
                <view class="action-btn edit-btn" bindtap="openMedicationRecordModal" data-medication-id="{{record._id}}" data-action="view">
                  <image class="action-icon" src="/images/icons/edit.svg" mode="aspectFit"></image>
                </view>
                <view class="action-btn delete-btn" bindtap="deleteMedication" data-medication-id="{{record._id}}" data-action="delete">
                  <image class="action-icon" src="/images/icons/delete.svg" mode="aspectFit"></image>
                </view>
              </view>
            </view>
          </view>
        </view>
        
        <view class="empty-record" wx:if="{{medicationRecords.length === 0}}">
          <text>æš‚æ— ç”¨è¯è®°å½•</text>
        </view>
      </view>
    </view>

    <!-- æ’ä¾¿è®°å½• -->
    <view class="tab-content" hidden="{{activeTab !== 'bowel'}}">
      <view class="bowel-records">
        <!-- æŒ‰ç±»å‹åˆ†ç»„æ˜¾ç¤º -->
        <view class="bowel-group" wx:for="{{bowelRecords}}" wx:key="type" wx:for-item="group">
          <view class="bowel-group-header">
            <text class="bowel-group-title">{{group.typeText}}</text>
            <text class="bowel-group-count">{{group.count}}æ¬¡</text>
          </view>
          
          <!-- è¯¥ç±»å‹çš„æ‰€æœ‰è®°å½• -->
          <view class="bowel-group-records">
            <view class="bowel-record-item" wx:for="{{group.records}}" wx:key="_id" wx:for-item="record" wx:for-index="recordIndex">
              <view class="record-content">
                <view class="bowel-time-type">
                  <text class="bowel-time">{{record.timeString}}</text>
                </view>
                <!-- å¤§ä¾¿è¯¦ç»†ä¿¡æ¯ -->
                <view class="bowel-details" wx:if="{{record.type === 'stool' || record.type === 'mixed'}}">
                  <text class="bowel-detail" wx:if="{{record.consistencyText}}">{{record.consistencyText}}</text>
                  <text class="bowel-detail" wx:if="{{record.colorText}}">{{record.colorText}}</text>
                  <text class="bowel-detail" wx:if="{{record.amountText}}">{{record.amountText}}</text>
                </view>
                <!-- å¤‡æ³¨ -->
                <view class="bowel-notes" wx:if="{{record.notes}}">
                  <text class="notes-text">{{record.notes}}</text>
                </view>
              </view>
              <!-- æ“ä½œæŒ‰é’® -->
              <view class="action-buttons">
                <view class="action-btn edit-btn" catchtap="editBowelRecord" data-group-index="{{index}}" data-record-index="{{recordIndex}}">
                  <image class="action-icon" src="/images/icons/edit.svg" mode="aspectFit"></image>
                </view>
                <view class="action-btn delete-btn" catchtap="deleteBowelRecord" data-record-id="{{record._id}}">
                  <image class="action-icon" src="/images/icons/delete.svg" mode="aspectFit"></image>
                </view>
              </view>
            </view>
          </view>
        </view>
        
        <view class="empty-record" wx:if="{{bowelRecords.length === 0}}">
          <text>æš‚æ— æ’ä¾¿è®°å½•</text>
        </view>
      </view>
    </view>
  </view>

  <!-- Medication Modal -->
  <view class="modal" wx:if="{{modals.medication}}" bindtap="closeMedicationModal" catchtouchmove="preventBubble">
    <view class="modal-content" catchtap="preventBubble">
      <view class="modal-header">
        <text>è®°å½•ç”¨è¯</text>
      </view>
      <view class="modal-body">
        <view class="modal-info-row">
          <text class="modal-label">è¯ç‰©åç§°:</text>
          <text class="modal-value">{{selectedMedicationInfo.name}}</text>
        </view>
        <view class="modal-info-row">
          <text class="modal-label">è¯ç‰©å‰‚é‡:</text>
          <view class="dosage-input-container">
            <input type="digit" class="dosage-input" value="{{currentModalDosage}}" bindinput="onMedicationDosageChange" placeholder="è¯·è¾“å…¥è¯ç‰©å‰‚é‡" />
            <text class="dosage-unit">{{selectedMedicationInfo.unit}}</text>
          </view>
        </view>
        <view class="modal-info-row" wx:if="{{selectedMedicationInfo.frequency}}">
          <text class="modal-label">æœç”¨é¢‘ç‡:</text>
          <text class="modal-value">{{selectedMedicationInfo.frequency}}</text>
        </view>
        <view class="modal-info-row">
          <text class="modal-label">æœç”¨æ—¶é—´:</text>
          <picker mode="time" value="{{currentModalTime}}" start="00:00" end="23:59" bindchange="onMedicationTimeChange">
            <view class="modal-time-picker">{{currentModalTime}} <text class="edit-icon">âœ</text></view>
          </picker>
        </view>
      </view>
      <view class="modal-footer">
        <button class="modal-btn cancel" bindtap="closeMedicationModal">å–æ¶ˆ</button>
        <button class="modal-btn confirm" bindtap="recordMedication">ç¡®è®¤</button>
      </view>
    </view>
  </view>
  
  <!-- ç¼–è¾‘è®°å½•å¼¹çª— -->
  <view class="modal" wx:if="{{modals.edit}}" bindtap="closeEditModal" catchtouchmove="preventBubble">
    <view class="modal-content" catchtap="preventBubble">
      <view class="modal-header">
        <text>ç¼–è¾‘å–‚å¥¶è®°å½•</text>
      </view>
      <view class="modal-body">
        <!-- æ—¶é—´é€‰æ‹© -->
        <view class="time-selection">
          <view class="time-picker-group">
            <text class="label">å¼€å§‹æ—¶é—´</text>
            <picker mode="time" value="{{editingFeeding.startTime}}" bindchange="onEditFeedingInput" data-field="startTime">
              <view class="time-picker">{{editingFeeding.startTime}}</view>
            </picker>
          </view>
          
          <view class="time-picker-group">
            <text class="label">ç»“æŸæ—¶é—´</text>
            <picker mode="time" value="{{editingFeeding.endTime}}" bindchange="onEditFeedingInput" data-field="endTime">
              <view class="time-picker">{{editingFeeding.endTime}}</view>
            </picker>
          </view>
        </view>
        
        <!-- å¤©ç„¶å¥¶é‡ -->
        <view class="input-group">
          <text class="label">{{proteinSourceLabel}}é‡</text>
          <view class="volume-control">
            <input type="digit" class="volume-input" value="{{editingFeeding.naturalMilkVolume}}" 
                  data-field="naturalMilkVolume" bindinput="onEditFeedingInput" />
            <text class="volume-unit">ml</text>
          </view>
        </view>
        
        <!-- æ™®é€šå¥¶ç²‰æƒ…å†µä¸‹æ˜¾ç¤ºå¥¶ç²‰é‡é‡ -->
        <view class="input-group" wx:if="{{proteinSourceType === 'formulaMilk'}}">
          <text class="label">å¥¶ç²‰é‡é‡</text>
          <view class="volume-control">
            <text class="volume-value">{{editingFeeding.formulaPowderWeight || '0'}}g</text>
          </view>
        </view>
        
        <!-- ç‰¹å¥¶é‡ -->
        <view class="input-group">
          <text class="label">ç‰¹å¥¶é‡</text>
          <view class="volume-control">
            <input type="digit" class="volume-input" value="{{editingFeeding.specialMilkVolume}}" 
                  data-field="specialMilkVolume" bindinput="onEditFeedingInput" />
            <text class="volume-unit">ml</text>
          </view>
        </view>
        
        <!-- è®¡ç®—ç»“æœ -->
        <view class="special-milk">
          <view class="special-milk-item">
            <text class="label">æ€»å¥¶é‡:</text>
            <text class="value">{{editingFeeding.totalVolume || '0'}}ml</text>
          </view>
          <view class="special-milk-item">
            <text class="label">ç‰¹å¥¶ç²‰:</text>
            <text class="value">{{editingFeeding.specialMilkPowder || '0'}}g</text>
          </view>
        </view>
      </view>
      <view class="modal-footer">
        <button class="modal-btn cancel" bindtap="closeEditModal">å–æ¶ˆ</button>
        <button class="modal-btn confirm" bindtap="saveEditedFeeding">ä¿å­˜</button>
      </view>
    </view>
  </view>
  
  <!-- è¯ç‰©è®°å½•è¯¦æƒ…å¼¹çª— -->
  <view class="modal" wx:if="{{modals.medicationRecord}}" bindtap="closeMedicationRecordModal" catchtouchmove="preventBubble">
    <view class="modal-content" catchtap="preventBubble">
      <view class="modal-header">
        <text>è¯ç‰©è®°å½•è¯¦æƒ…</text>
      </view>
      <view class="modal-body">
        <view class="modal-info-row">
          <text class="modal-label">è¯ç‰©åç§°:</text>
          <text class="modal-value">{{selectedMedicationRecord.medicationName}}</text>
        </view>
        <view class="modal-info-row">
          <text class="modal-label">è¯ç‰©å‰‚é‡:</text>
          <view class="dosage-input-container">
            <input type="digit" class="dosage-input" value="{{selectedMedicationRecord.dosage}}" bindinput="onMedicationRecordDosageChange" />
            <text class="dosage-unit">{{selectedMedicationRecord.unit}}</text>
          </view>
        </view>
        <view class="modal-info-row">
          <text class="modal-label">æœç”¨æ—¶é—´:</text>
          <picker mode="time" value="{{selectedMedicationRecord.actualTime}}" start="00:00" end="23:59" bindchange="onMedicationRecordTimeChange">
            <view class="modal-time-picker">{{selectedMedicationRecord.actualTime}} <text class="edit-icon">âœ</text></view>
          </picker>
        </view>
        <view class="modal-info-row" wx:if="{{selectedMedicationRecord.frequency}}">
          <text class="modal-label">æœç”¨é¢‘ç‡:</text>
          <text class="modal-value">{{selectedMedicationRecord.frequency}}</text>
        </view>
      </view>
      <view class="modal-footer">
        <button class="modal-btn cancel" bindtap="closeMedicationRecordModal">å–æ¶ˆ</button>
        <button class="modal-btn confirm" bindtap="saveMedicationRecordChanges">ä¿å­˜</button>
      </view>
    </view>
  </view>
  
  <!-- å¿«æ·è®°å½•å¼¹çª— -->
  <view class="modal" wx:if="{{modals.quickInput}}" bindtap="hideQuickInputModal" catchtouchmove="preventBubble">
    <view class="modal-content" catchtap="preventBubble">
      <view class="modal-header">
        <text>å¿«æ·è®°å½•</text>
      </view>
      <view class="modal-body">
        <!-- æ—¶é—´é€‰æ‹© -->
        <view class="time-selection">
          <view class="time-picker-group">
            <text class="label">å¼€å§‹æ—¶é—´</text>
            <picker mode="time" value="{{quickFeedingData.startTime}}" bindchange="onQuickStartTimeChange">
              <view class="time-picker">{{quickFeedingData.startTime || 'é€‰æ‹©æ—¶é—´'}}</view>
            </picker>
          </view>
          
          <view class="time-picker-group">
            <text class="label">ç»“æŸæ—¶é—´</text>
            <picker mode="time" value="{{quickFeedingData.endTime}}" bindchange="onQuickEndTimeChange">
              <view class="time-picker">{{quickFeedingData.endTime || 'é€‰æ‹©æ—¶é—´'}}</view>
            </picker>
          </view>
        </view>
        
        <!-- å¤©ç„¶å¥¶é‡ -->
        <view class="input-group">
          <text class="label">{{proteinSourceLabel}}é‡</text>
          <view class="volume-control">
            <button class="volume-btn decrease" catchtap="decreaseVolume" data-field="quickNaturalMilk">âˆ’</button>
            <input type="digit" class="volume-input" value="{{quickFeedingData.naturalMilkVolume}}" 
                  data-field="quickNaturalMilk" bindinput="onQuickFeedingInput" />
            <button class="volume-btn increase" catchtap="increaseVolume" data-field="quickNaturalMilk">+</button>
            <text class="volume-unit">ml</text>
          </view>
        </view>
        
        <!-- æ™®é€šå¥¶ç²‰æƒ…å†µä¸‹æ˜¾ç¤ºå¥¶ç²‰é‡é‡ -->
        <view class="input-group" wx:if="{{proteinSourceType === 'formulaMilk'}}">
          <text class="label">å¥¶ç²‰é‡é‡</text>
          <view class="volume-control">
            <text class="volume-value">{{quickFeedingData.formulaPowderWeight || '0'}}g</text>
          </view>
        </view>
        
        <!-- ç‰¹å¥¶é‡ -->
        <view class="input-group">
          <text class="label">ç‰¹å¥¶é‡</text>
          <view class="volume-control">
            <button class="volume-btn decrease" catchtap="decreaseVolume" data-field="quickSpecialMilk">âˆ’</button>
            <input type="digit" class="volume-input" value="{{quickFeedingData.specialMilkVolume}}" 
                  data-field="quickSpecialMilk" bindinput="onQuickFeedingInput" />
            <button class="volume-btn increase" catchtap="increaseVolume" data-field="quickSpecialMilk">+</button>
            <text class="volume-unit">ml</text>
          </view>
        </view>
        
        <!-- è®¡ç®—ç»“æœå±•ç¤º -->
        <view class="special-milk">
          <view class="special-milk-item">
            <text class="label">æ€»å¥¶é‡:</text>
            <text class="value">{{quickFeedingData.totalVolume || '0'}}ml</text>
          </view>
          <view class="special-milk-item">
            <text class="label">ç‰¹å¥¶ç²‰:</text>
            <text class="value">{{quickFeedingData.specialMilkPowder || '0'}}g</text>
          </view>
        </view>
      </view>
      <view class="modal-footer">
        <button class="modal-btn cancel" bindtap="hideQuickInputModal">å–æ¶ˆ</button>
        <button class="modal-btn confirm" bindtap="saveQuickFeeding">ç¡®è®¤è®°å½•</button>
      </view>
    </view>
  </view>

  <!-- æ’ä¾¿è®°å½•å¼¹çª— -->
  <view class="modal bowel-record-modal" wx:if="{{modals.bowelRecord}}" bindtap="hideBowelRecordModal" catchtouchmove="preventBubble">
    <view class="modal-content" catchtap="preventBubble">
      <view class="modal-header">
        <text>è®°å½•æ’ä¾¿</text>
      </view>
      <scroll-view class="modal-body" scroll-y="true" enhanced="true" show-scrollbar="false">
        <!-- æ—¶é—´é€‰æ‹© -->
        <view class="modal-info-row">
          <text class="modal-label">æ—¶é—´:</text>
          <picker mode="time" value="{{newBowelRecord.time}}" start="00:00" end="23:59" bindchange="onBowelTimeChange">
            <view class="modal-time-picker">{{newBowelRecord.time}} <text class="edit-icon">âœ</text></view>
          </picker>
        </view>
        
        <!-- ç±»å‹é€‰æ‹© -->
        <view class="modal-info-row">
          <text class="modal-label">ç±»å‹:</text>
          <view class="bowel-type-selector">
            <view class="type-option {{newBowelRecord.type === 'stool' ? 'selected' : ''}}" 
                  data-field="type" data-value="stool" bindtap="onBowelRecordSelect">
              <text>å¤§ä¾¿</text>
            </view>
            <view class="type-option {{newBowelRecord.type === 'urine' ? 'selected' : ''}}" 
                  data-field="type" data-value="urine" bindtap="onBowelRecordSelect">
              <text>å°ä¾¿</text>
            </view>
            <view class="type-option {{newBowelRecord.type === 'mixed' ? 'selected' : ''}}" 
                  data-field="type" data-value="mixed" bindtap="onBowelRecordSelect">
              <text>æ··åˆ</text>
            </view>
          </view>
        </view>
        
        <!-- å¤§ä¾¿è¯¦ç»†ä¿¡æ¯ï¼ˆä»…åœ¨å¤§ä¾¿æˆ–æ··åˆæ—¶æ˜¾ç¤ºï¼‰ -->
        <view class="bowel-detail-section" wx:if="{{newBowelRecord.type === 'stool' || newBowelRecord.type === 'mixed'}}">
          <!-- æ€§çŠ¶ -->
          <view class="modal-info-row">
            <text class="modal-label">æ€§çŠ¶:</text>
            <view class="bowel-option-selector">
              <view class="option-item {{newBowelRecord.consistency === 'liquid' ? 'selected' : ''}}" 
                    data-field="consistency" data-value="liquid" bindtap="onBowelRecordSelect">
                <text>æ°´æ ·</text>
              </view>
              <view class="option-item {{newBowelRecord.consistency === 'loose' ? 'selected' : ''}}" 
                    data-field="consistency" data-value="loose" bindtap="onBowelRecordSelect">
                <text>ç¨€ä¾¿</text>
              </view>
              <view class="option-item {{newBowelRecord.consistency === 'soft' ? 'selected' : ''}}" 
                    data-field="consistency" data-value="soft" bindtap="onBowelRecordSelect">
                <text>ç³ŠçŠ¶</text>
              </view>
              <view class="option-item {{newBowelRecord.consistency === 'normal' ? 'selected' : ''}}" 
                    data-field="consistency" data-value="normal" bindtap="onBowelRecordSelect">
                <text>æ­£å¸¸</text>
              </view>
              <view class="option-item {{newBowelRecord.consistency === 'hard' ? 'selected' : ''}}" 
                    data-field="consistency" data-value="hard" bindtap="onBowelRecordSelect">
                <text>å¹²ç¡¬</text>
              </view>
            </view>
          </view>
          
          <!-- é¢œè‰² -->
          <view class="modal-info-row">
            <text class="modal-label">é¢œè‰²:</text>
            <view class="bowel-option-selector">
              <view class="option-item {{newBowelRecord.color === 'yellow' ? 'selected' : ''}}" 
                    data-field="color" data-value="yellow" bindtap="onBowelRecordSelect">
                <text>é»„è‰²</text>
              </view>
              <view class="option-item {{newBowelRecord.color === 'green' ? 'selected' : ''}}" 
                    data-field="color" data-value="green" bindtap="onBowelRecordSelect">
                <text>ç»¿è‰²</text>
              </view>
              <view class="option-item {{newBowelRecord.color === 'brown' ? 'selected' : ''}}" 
                    data-field="color" data-value="brown" bindtap="onBowelRecordSelect">
                <text>è¤è‰²</text>
              </view>
              <view class="option-item {{newBowelRecord.color === 'white' ? 'selected' : ''}}" 
                    data-field="color" data-value="white" bindtap="onBowelRecordSelect">
                <text>ç™½è‰²</text>
              </view>
              <view class="option-item {{newBowelRecord.color === 'red' ? 'selected' : ''}}" 
                    data-field="color" data-value="red" bindtap="onBowelRecordSelect">
                <text>çº¢è‰²</text>
              </view>
              <view class="option-item {{newBowelRecord.color === 'black' ? 'selected' : ''}}" 
                    data-field="color" data-value="black" bindtap="onBowelRecordSelect">
                <text>é»‘è‰²</text>
              </view>
            </view>
          </view>
          
          <!-- æ°”å‘³ -->
          <view class="modal-info-row">
            <text class="modal-label">æ°”å‘³:</text>
            <view class="bowel-option-selector">
              <view class="option-item {{newBowelRecord.smell === 'normal' ? 'selected' : ''}}" 
                    data-field="smell" data-value="normal" bindtap="onBowelRecordSelect">
                <text>æ­£å¸¸</text>
              </view>
              <view class="option-item {{newBowelRecord.smell === 'sour' ? 'selected' : ''}}" 
                    data-field="smell" data-value="sour" bindtap="onBowelRecordSelect">
                <text>é…¸è‡­</text>
              </view>
              <view class="option-item {{newBowelRecord.smell === 'fishy' ? 'selected' : ''}}" 
                    data-field="smell" data-value="fishy" bindtap="onBowelRecordSelect">
                <text>è…¥è‡­</text>
              </view>
              <view class="option-item {{newBowelRecord.smell === 'odorless' ? 'selected' : ''}}" 
                    data-field="smell" data-value="odorless" bindtap="onBowelRecordSelect">
                <text>æ— å‘³</text>
              </view>
            </view>
          </view>
          
          <!-- åˆ†é‡ -->
          <view class="modal-info-row">
            <text class="modal-label">åˆ†é‡:</text>
            <view class="bowel-option-selector">
              <view class="option-item {{newBowelRecord.amount === 'small' ? 'selected' : ''}}" 
                    data-field="amount" data-value="small" bindtap="onBowelRecordSelect">
                <text>å°‘é‡</text>
              </view>
              <view class="option-item {{newBowelRecord.amount === 'medium' ? 'selected' : ''}}" 
                    data-field="amount" data-value="medium" bindtap="onBowelRecordSelect">
                <text>é€‚é‡</text>
              </view>
              <view class="option-item {{newBowelRecord.amount === 'large' ? 'selected' : ''}}" 
                    data-field="amount" data-value="large" bindtap="onBowelRecordSelect">
                <text>å¤§é‡</text>
              </view>
            </view>
          </view>
        </view>
        
        <!-- å¤‡æ³¨ -->
        <view class="modal-info-row">
          <text class="modal-label">å¤‡æ³¨:</text>
          <textarea class="notes-input" placeholder="å¯é€‰ï¼Œè®°å½•ç‰¹æ®Šæƒ…å†µ" 
                    value="{{newBowelRecord.notes}}" data-field="notes" bindinput="onBowelRecordInput"></textarea>
        </view>
      </scroll-view>
      <view class="modal-footer">
        <button class="modal-btn cancel" bindtap="hideBowelRecordModal">å–æ¶ˆ</button>
        <button class="modal-btn confirm" bindtap="saveBowelRecord">ä¿å­˜</button>
      </view>
    </view>
  </view>

  <!-- ç¼–è¾‘æ’ä¾¿è®°å½•å¼¹çª— -->
  <view class="modal bowel-edit-modal" wx:if="{{modals.bowelEdit}}" bindtap="hideBowelEditModal" catchtouchmove="preventBubble">
    <view class="modal-content" catchtap="preventBubble">
      <view class="modal-header">
        <text>ç¼–è¾‘æ’ä¾¿è®°å½•</text>
      </view>
      <scroll-view class="modal-body" scroll-y="true" enhanced="true" show-scrollbar="false">
        <!-- æ—¶é—´é€‰æ‹© -->
        <view class="modal-info-row">
          <text class="modal-label">æ—¶é—´:</text>
          <picker mode="time" value="{{editingBowelRecord.timeString}}" start="00:00" end="23:59" bindchange="onEditBowelTimeChange">
            <view class="modal-time-picker">{{editingBowelRecord.timeString}} <text class="edit-icon">âœ</text></view>
          </picker>
        </view>
        
        <!-- ç±»å‹é€‰æ‹© -->
        <view class="modal-info-row">
          <text class="modal-label">ç±»å‹:</text>
          <view class="bowel-type-selector">
            <view class="type-option {{editingBowelRecord.type === 'stool' ? 'selected' : ''}}" 
                  data-field="type" data-value="stool" bindtap="onEditBowelRecordSelect">
              <text>å¤§ä¾¿</text>
            </view>
            <view class="type-option {{editingBowelRecord.type === 'urine' ? 'selected' : ''}}" 
                  data-field="type" data-value="urine" bindtap="onEditBowelRecordSelect">
              <text>å°ä¾¿</text>
            </view>
            <view class="type-option {{editingBowelRecord.type === 'mixed' ? 'selected' : ''}}" 
                  data-field="type" data-value="mixed" bindtap="onEditBowelRecordSelect">
              <text>æ··åˆ</text>
            </view>
          </view>
        </view>
        
        <!-- å¤§ä¾¿è¯¦ç»†ä¿¡æ¯ï¼ˆä»…åœ¨å¤§ä¾¿æˆ–æ··åˆæ—¶æ˜¾ç¤ºï¼‰ -->
        <view class="bowel-detail-section" wx:if="{{editingBowelRecord.type === 'stool' || editingBowelRecord.type === 'mixed'}}">
          <!-- æ€§çŠ¶ -->
          <view class="modal-info-row">
            <text class="modal-label">æ€§çŠ¶:</text>
            <view class="bowel-option-selector">
              <view class="option-item {{editingBowelRecord.consistency === 'liquid' ? 'selected' : ''}}" 
                    data-field="consistency" data-value="liquid" bindtap="onEditBowelRecordSelect">
                <text>æ°´æ ·</text>
              </view>
              <view class="option-item {{editingBowelRecord.consistency === 'loose' ? 'selected' : ''}}" 
                    data-field="consistency" data-value="loose" bindtap="onEditBowelRecordSelect">
                <text>ç¨€ä¾¿</text>
              </view>
              <view class="option-item {{editingBowelRecord.consistency === 'soft' ? 'selected' : ''}}" 
                    data-field="consistency" data-value="soft" bindtap="onEditBowelRecordSelect">
                <text>ç³ŠçŠ¶</text>
              </view>
              <view class="option-item {{editingBowelRecord.consistency === 'normal' ? 'selected' : ''}}" 
                    data-field="consistency" data-value="normal" bindtap="onEditBowelRecordSelect">
                <text>æ­£å¸¸</text>
              </view>
              <view class="option-item {{editingBowelRecord.consistency === 'hard' ? 'selected' : ''}}" 
                    data-field="consistency" data-value="hard" bindtap="onEditBowelRecordSelect">
                <text>å¹²ç¡¬</text>
              </view>
            </view>
          </view>
          
          <!-- é¢œè‰² -->
          <view class="modal-info-row">
            <text class="modal-label">é¢œè‰²:</text>
            <view class="bowel-option-selector">
              <view class="option-item {{editingBowelRecord.color === 'yellow' ? 'selected' : ''}}" 
                    data-field="color" data-value="yellow" bindtap="onEditBowelRecordSelect">
                <text>é»„è‰²</text>
              </view>
              <view class="option-item {{editingBowelRecord.color === 'green' ? 'selected' : ''}}" 
                    data-field="color" data-value="green" bindtap="onEditBowelRecordSelect">
                <text>ç»¿è‰²</text>
              </view>
              <view class="option-item {{editingBowelRecord.color === 'brown' ? 'selected' : ''}}" 
                    data-field="color" data-value="brown" bindtap="onEditBowelRecordSelect">
                <text>è¤è‰²</text>
              </view>
              <view class="option-item {{editingBowelRecord.color === 'white' ? 'selected' : ''}}" 
                    data-field="color" data-value="white" bindtap="onEditBowelRecordSelect">
                <text>ç™½è‰²</text>
              </view>
              <view class="option-item {{editingBowelRecord.color === 'red' ? 'selected' : ''}}" 
                    data-field="color" data-value="red" bindtap="onEditBowelRecordSelect">
                <text>çº¢è‰²</text>
              </view>
              <view class="option-item {{editingBowelRecord.color === 'black' ? 'selected' : ''}}" 
                    data-field="color" data-value="black" bindtap="onEditBowelRecordSelect">
                <text>é»‘è‰²</text>
              </view>
            </view>
          </view>
          
          <!-- æ°”å‘³ -->
          <view class="modal-info-row">
            <text class="modal-label">æ°”å‘³:</text>
            <view class="bowel-option-selector">
              <view class="option-item {{editingBowelRecord.smell === 'normal' ? 'selected' : ''}}" 
                    data-field="smell" data-value="normal" bindtap="onEditBowelRecordSelect">
                <text>æ­£å¸¸</text>
              </view>
              <view class="option-item {{editingBowelRecord.smell === 'sour' ? 'selected' : ''}}" 
                    data-field="smell" data-value="sour" bindtap="onEditBowelRecordSelect">
                <text>é…¸è‡­</text>
              </view>
              <view class="option-item {{editingBowelRecord.smell === 'fishy' ? 'selected' : ''}}" 
                    data-field="smell" data-value="fishy" bindtap="onEditBowelRecordSelect">
                <text>è…¥è‡­</text>
              </view>
              <view class="option-item {{editingBowelRecord.smell === 'odorless' ? 'selected' : ''}}" 
                    data-field="smell" data-value="odorless" bindtap="onEditBowelRecordSelect">
                <text>æ— å‘³</text>
              </view>
            </view>
          </view>
          
          <!-- åˆ†é‡ -->
          <view class="modal-info-row">
            <text class="modal-label">åˆ†é‡:</text>
            <view class="bowel-option-selector">
              <view class="option-item {{editingBowelRecord.amount === 'small' ? 'selected' : ''}}" 
                    data-field="amount" data-value="small" bindtap="onEditBowelRecordSelect">
                <text>å°‘é‡</text>
              </view>
              <view class="option-item {{editingBowelRecord.amount === 'medium' ? 'selected' : ''}}" 
                    data-field="amount" data-value="medium" bindtap="onEditBowelRecordSelect">
                <text>é€‚é‡</text>
              </view>
              <view class="option-item {{editingBowelRecord.amount === 'large' ? 'selected' : ''}}" 
                    data-field="amount" data-value="large" bindtap="onEditBowelRecordSelect">
                <text>å¤§é‡</text>
              </view>
            </view>
          </view>
        </view>
        
        <!-- å¤‡æ³¨ -->
        <view class="modal-info-row">
          <text class="modal-label">å¤‡æ³¨:</text>
          <textarea class="notes-input" placeholder="å¯é€‰ï¼Œè®°å½•ç‰¹æ®Šæƒ…å†µ" 
                    value="{{editingBowelRecord.notes}}" data-field="notes" bindinput="onEditBowelRecordInput"></textarea>
        </view>
      </scroll-view>
      <view class="modal-footer">
        <button class="modal-btn cancel" bindtap="hideBowelEditModal">å–æ¶ˆ</button>
        <button class="modal-btn confirm" bindtap="saveEditedBowelRecord">ä¿å­˜</button>
      </view>
    </view>
  </view>
</view> 