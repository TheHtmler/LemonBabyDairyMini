<view class="container">
  <!-- æ—¥æœŸé€‰æ‹©å™¨ -->
  <view class="date-selector">
    <!-- å½“å‰æ—¥æœŸæ˜¾ç¤º -->
    <view class="current-date">
      <text class="date-text">{{todayFullDate}}</text>
    </view>
    <!-- æ—¥æœŸæ»‘åŠ¨åŒºåŸŸ1 -->
    <view class="date-scroll-container">
      <scroll-view scroll-x="true" scroll-into-view="{{currentDateId}}" scroll-with-animation="true" class="date-list" enhanced="true" show-scrollbar="false" enable-flex="{{false}}" bounces="{{true}}" fast-deceleration="{{true}}">
        <view class="date-items-container">
          <view id="date-{{index}}" class="date-item {{selectedDateIndex === index ? 'selected' : ''}} {{index === 0 ? 'today' : ''}}" wx:for="{{dateList}}" wx:key="date" data-date="{{item.date}}" data-index="{{index}}" bindtap="onDateItemClick">
            <text class="weekday">{{item.weekday}}</text>
            <text class="day">{{item.day}}</text>
            <text class="month">{{item.month}}æœˆ</text>
          </view>
          <view class="date-more-indicator" bindtap="showCalendar">
            <text>æ›´å¤š</text>
          </view>
        </view>
      </scroll-view>
    </view>
  </view>
  <fat-ratio-popup
    visible="{{showFatRatioPopup}}"
    lines="{{fatRatioPopupLines}}"
    bind:close="hideFatRatioPopup"
  />
  <!-- è®°å½•å†…å®¹åŒºåŸŸ -->
  <view class="records-wrapper" style="opacity: {{isDataLoading ? 0.5 : 1}};">
    <!-- æ—¥æœŸæ˜¾ç¤ºå¤´éƒ¨ -->
    <view class="date-header">
      <view class="selected-date">{{formattedSelectedDate}}</view>
      <view class="calendar-icon" bindtap="showCalendar">æ—¥å†</view>
    </view>
    <!-- æ— è®°å½•æç¤º -->
    <view class="empty-data" wx:if="{{feedingRecords.length === 0 && medicationRecords.length === 0 && bowelRecords.length === 0}}" style="opacity: {{isDataLoading ? 0.5 : 1}}; transition: opacity 0.3s;">
      <view class="empty-icon">ğŸ“</view>
      <view class="empty-text">å½“æ—¥æš‚æ— è®°å½•</view>
      <view class="empty-actions">
        <view class="add-btn" bindtap="showAddFeedingModal">
          <image class="add-icon" src="/images/icons/add.svg" mode="aspectFit"></image>
          <text>è¡¥å……å–‚å¥¶è®°å½•</text>
        </view>
        <view class="add-btn" bindtap="showAddMedicationModal">
          <image class="add-icon" src="/images/icons/add.svg" mode="aspectFit"></image>
          <text>è¡¥å……ç”¨è¯è®°å½•</text>
        </view>
        <view class="add-btn" bindtap="showAddBowelModal">
          <image class="add-icon" src="/images/icons/add.svg" mode="aspectFit"></image>
          <text>è¡¥å……æ’ä¾¿è®°å½•</text>
        </view>
      </view>
    </view>
    <!-- æœ‰è®°å½•æ—¶æ˜¾ç¤ºå†…å®¹ -->
    <block wx:else>
      <!-- å–‚å¥¶è®°å½•æ±‡æ€»å¡ç‰‡ -->
      <view class="card">
        <view class="card-title">
          <text>å½“æ—¥æ±‡æ€»æ•°æ®</text>
        </view>
        <view class="summary-section">
          <view class="section-subtitle">åŸºç¡€ä¿¡æ¯</view>
          <view class="summary-grid">
            <view class="summary-item">
              <view class="summary-label">ä½“é‡</view>
              <view class="summary-number weight-number">
                <input class="weight-input" type="digit" value="{{weight}}" placeholder="è¯·è¾“å…¥ä½“é‡" bindinput="onWeightInput" bindblur="onWeightBlur" />
              </view>
              <view class="summary-unit">kg</view>
            </view>
            <view class="summary-item">
              <view class="summary-label">èº«é«˜</view>
              <view class="summary-number">{{height}}</view>
              <view class="summary-unit">cm</view>
            </view>
            <view class="summary-item">
              <view class="summary-label">æ€»å¥¶é‡</view>
              <view class="summary-number">{{totalMilk || 0}}</view>
              <view class="summary-unit">ml</view>
            </view>
          </view>
        </view>

        <view class="summary-section">
          <view class="section-subtitle">çƒ­é‡ç»Ÿè®¡</view>
          <view class="summary-grid">
            <view class="summary-item">
              <view class="summary-label">æ€»çƒ­é‡</view>
              <view class="summary-number">{{dailyCaloriesTotal || 0}}</view>
              <view class="summary-unit">kcal/d</view>
            </view>
            <view class="summary-item">
              <view class="summary-label">æ™®å¥¶çƒ­é‡</view>
              <view class="summary-number">{{intakeOverview.milk.normal.calories || 0}}</view>
              <view class="summary-unit">kcal</view>
            </view>
            <view class="summary-item">
              <view class="summary-label">ç‰¹å¥¶çƒ­é‡</view>
              <view class="summary-number">{{intakeOverview.milk.special.calories || 0}}</view>
              <view class="summary-unit">kcal</view>
            </view>
            <view class="summary-item">
              <view class="summary-label">é£Ÿç‰©çƒ­é‡</view>
              <view class="summary-number">{{intakeOverview.food.totalCalories || 0}}</view>
              <view class="summary-unit">kcal</view>
            </view>
            <view class="summary-item">
              <view class="summary-label">çƒ­é‡ç³»æ•°</view>
              <view class="summary-number">{{caloriePerKg !== '' ? caloriePerKg : '--'}}</view>
              <view class="summary-unit">kcal/kg/d</view>
            </view>
            <view class="summary-item">
              <view class="summary-label">ç›®æ ‡çƒ­é‡ç³»æ•°</view>
              <view class="summary-number">
                {{calorieGoalPerKgRange.min}}~{{calorieGoalPerKgRange.max}}
              </view>
              <view class="summary-unit">kcal/kg/d</view>
              <!-- <view class="summary-subtext" wx:if="{{goalKcalRange.min && goalKcalRange.max}}">
                çº¦ {{goalKcalRange.min}}~{{goalKcalRange.max}} kcal/d
              </view> -->
              <view class="summary-subtext" wx:if="{{calorieGoalPerKgRange.label}}">
                {{calorieGoalPerKgRange.label}}
              </view>
            </view>
          </view>
        </view>

        <view class="summary-section">
          <view class="section-subtitle">è›‹ç™½ç»Ÿè®¡</view>
          <view class="summary-grid">
            <view class="summary-item">
              <view class="summary-label">æ€»è›‹ç™½</view>
              <view class="summary-number">
                {{proteinSummaryDisplay.total}}
              </view>
              <view class="summary-unit">g</view>
            </view>
            <view class="summary-item">
              <view class="summary-label">å¤©ç„¶è›‹ç™½</view>
              <view class="summary-number">
                {{proteinSummaryDisplay.natural}}
              </view>
              <view class="summary-unit">g</view>
            </view>
            <view class="summary-item">
              <view class="summary-label">ç‰¹æ®Šè›‹ç™½</view>
              <view class="summary-number">
                {{proteinSummaryDisplay.special}}
              </view>
              <view class="summary-unit">g</view>
            </view>
            <view class="summary-item">
              <view class="summary-label">å¤©ç„¶è›‹ç™½ç³»æ•°</view>
              <view class="summary-number">{{naturalProteinCoefficient || '--'}}</view>
              <view class="summary-unit">g/kg/d</view>
            </view>
            <view class="summary-item">
              <view class="summary-label">ç‰¹æ®Šè›‹ç™½ç³»æ•°</view>
              <view class="summary-number">{{specialProteinCoefficient || '--'}}</view>
              <view class="summary-unit">g/kg/d</view>
            </view>
          </view>
        </view>

        <view class="summary-section">
          <view class="macro-ratio-header">
            <view class="section-subtitle">ä¾›èƒ½å æ¯”</view>
          </view>
          <view class="summary-grid">
            <view class="summary-item">
              <view class="summary-label">è›‹ç™½</view>
              <view class="summary-number">{{macroRatios.protein || 0}}%</view>
              <view class="summary-subtext">å‚è€ƒ 10%-15%</view>
            </view>
            <view class="summary-item">
              <view class="summary-label">ç¢³æ°´</view>
              <view class="summary-number">{{macroRatios.carbs || 0}}%</view>
              <view class="summary-subtext">å‚è€ƒ 55%-60%</view>
            </view>
            <view class="summary-item">
              <view class="summary-label-row">
                <text class="summary-label">è„‚è‚ª</text>
                <text class="ratio-info-icon" bindtap="showFatRatioPopup">i</text>
              </view>
              <view class="summary-number">{{macroRatios.fat || 0}}%</view>
              <view class="summary-subtext">å‚è€ƒ {{fatRatioRangeText || '--'}}</view>
            </view>
          </view>
        </view>
      </view>
      <!-- é£Ÿç‰©æ‘„å…¥å¡ç‰‡ -->
      <view class="card intake-overview-card">
        <view class="card-title">
          <text>æ‘„å…¥æ¦‚è§ˆ</text>
        </view>
        <view class="records-summary">
          <view class="summary-card milk-card">
            <view class="card-header">
              <text class="card-title">å–‚å¥¶</text>
              <text class="card-meta">çƒ­é‡ {{intakeOverview.milk.totalCalories || 0}} kcal</text>
            </view>
            <view class="card-body milk-body">
              <view class="milk-column">
                <text class="column-title">å¤©ç„¶å–‚å…»</text>
                <view class="stat-row">
                  <text>ä½“ç§¯</text>
                  <text>{{intakeOverview.milk.normal.volume || 0}} ml</text>
                </view>
                <view class="stat-row">
                  <text>è›‹ç™½</text>
                  <text>{{intakeOverview.milk.normal.protein || 0}} g</text>
                </view>
                <view class="stat-row">
                  <text>è›‹ç™½ç³»æ•°</text>
                  <text>{{intakeOverview.milk.normal.coefficient !== '' ? intakeOverview.milk.normal.coefficient : 'â€”'}} g/kg/d</text>
                </view>
                <view class="stat-row">
                  <text>çƒ­é‡</text>
                  <text>{{intakeOverview.milk.normal.calories || 0}} kcal</text>
                </view>
                <view class="stat-row">
                  <text>ç¢³æ°´</text>
                  <text>{{intakeOverview.milk.normal.carbs || 0}} g</text>
                </view>
                <view class="stat-row">
                  <text>è„‚è‚ª</text>
                  <text>{{intakeOverview.milk.normal.fat || 0}} g</text>
                </view>
              </view>
              <view class="milk-column">
                <text class="column-title">ç‰¹å¥¶</text>
                <view class="stat-row">
                  <text>ä½“ç§¯</text>
                  <text>{{intakeOverview.milk.special.volume || 0}} ml</text>
                </view>
                <view class="stat-row">
                  <text>è›‹ç™½</text>
                  <text>{{intakeOverview.milk.special.protein || 0}} g</text>
                </view>
                <view class="stat-row">
                  <text>è›‹ç™½ç³»æ•°</text>
                  <text>{{intakeOverview.milk.special.coefficient !== '' ? intakeOverview.milk.special.coefficient : 'â€”'}} g/kg/d</text>
                </view>
                <view class="stat-row">
                  <text>çƒ­é‡</text>
                  <text>{{intakeOverview.milk.special.calories || 0}} kcal</text>
                </view>
                <view class="stat-row">
                  <text>ç¢³æ°´</text>
                  <text>{{intakeOverview.milk.special.carbs || 0}} g</text>
                </view>
                <view class="stat-row">
                  <text>è„‚è‚ª</text>
                  <text>{{intakeOverview.milk.special.fat || 0}} g</text>
                </view>
              </view>
            </view>
          </view>
          <view class="summary-card food-card">
            <view class="card-header">
              <text class="card-title">é£Ÿç‰©</text>
              <text class="card-meta">çƒ­é‡ {{intakeOverview.food.totalCalories || 0}} kcal</text>
            </view>
            <view class="card-body food-body">
              <view class="body-summary">
                <text>è›‹ç™½ {{intakeOverview.food.protein || 0}} g</text>
                <text>ç¢³æ°´ {{intakeOverview.food.carbs || 0}} g Â· è„‚è‚ª {{intakeOverview.food.fat || 0}} g</text>
              </view>
              <view class="empty-record" wx:if="{{intakeOverview.food.count === 0}}">
                <text>æš‚æ— é£Ÿç‰©æ‘„å…¥è®°å½•</text>
              </view>
            </view>
          </view>
        </view>
      </view>
      <!-- è®°å½•é€‰é¡¹å¡ -->
      <view class="tabs">
        <view class="tab {{activeTab === 'feeding' ? 'active' : ''}}" data-tab="feeding" bindtap="switchTab">
          <text>å–‚å¥¶è®°å½•</text>
        </view>
        <view class="tab {{activeTab === 'food' ? 'active' : ''}}" data-tab="food" bindtap="switchTab">
          <text>é£Ÿç‰©è®°å½•</text>
        </view>
        <view class="tab {{activeTab === 'medication' ? 'active' : ''}}" data-tab="medication" bindtap="switchTab">
          <text>ç”¨è¯è®°å½•</text>
        </view>
      </view>

      <block wx:if="{{activeTab === 'food'}}">
        <view class="card">
          <view class="card-title">
            <text>é£Ÿç‰©æ‘„å…¥</text>
            <view class="add-btn" bindtap="showFoodIntakeExperimentModal">
              <image class="add-icon" src="/images/icons/add.svg" mode="aspectFit"></image>
              <text>è¡¥å……é£Ÿç‰©</text>
            </view>
          </view>
          <view class="intake-list" wx:if="{{foodIntakes.length > 0}}">
            <view class="food-record-item" wx:for="{{foodIntakes}}" wx:key="_id">
              <view class="record-content">
                <food-record-item record="{{item}}" />
              </view>
              <view class="action-buttons">
                <view class="action-btn edit-btn" bindtap="openEditFoodModal" data-index="{{index}}" data-id="{{item._id}}">
                  <image class="action-icon" src="/images/icons/edit.svg" mode="aspectFit"></image>
                </view>
                <view class="action-btn delete-btn" bindtap="deleteFoodIntake" data-index="{{index}}" data-id="{{item._id}}">
                  <image class="action-icon" src="/images/icons/delete.svg" mode="aspectFit"></image>
                </view>
              </view>
            </view>
          </view>
          <view class="empty-data" wx:if="{{foodIntakes.length === 0}}">
            <view class="empty-text">æš‚æ— é£Ÿç‰©è®°å½•</view>
          </view>
        </view>
      </block>

      <block wx:elif="{{activeTab === 'medication'}}">
        <view class="card">
          <view class="card-title">
            <text>ç”¨è¯è®°å½•</text>
            <view class="add-btn" bindtap="showAddMedicationModal">
              <image class="add-icon" src="/images/icons/add.svg" mode="aspectFit"></image>
              <text>è¡¥å……è®°å½•</text>
            </view>
          </view>
          <view>
            <!-- æŒ‰è¯ç‰©åç§°åˆ†ç»„æ˜¾ç¤º -->
            <view class="medication-group" wx:for="{{groupedMedicationRecords}}" wx:key="medicationName" wx:for-item="group">
              <view class="medication-group-header">
                <text class="medication-group-name">{{group.medicationName}}</text>
                <text class="medication-group-count">ä»Šæ—¥{{group.totalCount}}æ¬¡</text>
              </view>
              <!-- è¯¥è¯ç‰©çš„æ‰€æœ‰è®°å½• -->
              <view class="medication-group-records">
                <view class="medication-record-item" wx:for="{{group.records}}" wx:key="_id" wx:for-item="record">
                  <view class="record-content">
                    <view class="medication-time-dose">
                      <text class="medication-time">{{record.actualTime}}</text>
                      <text class="medication-volume">{{record.dosage}}{{record.unit}}</text>
                    </view>
                  </view>
                  <!-- æ“ä½œæŒ‰é’® -->
                  <view class="action-buttons">
                    <view class="action-btn edit-btn" bindtap="openEditMedicationModal" data-record-id="{{record._id}}">
                      <image class="action-icon" src="/images/icons/edit.svg" mode="aspectFit"></image>
                    </view>
                    <view class="action-btn delete-btn" bindtap="deleteMedication" data-record-id="{{record._id}}">
                      <image class="action-icon" src="/images/icons/delete.svg" mode="aspectFit"></image>
                    </view>
                  </view>
                </view>
              </view>
            </view>
          </view>
          <view class="empty-data" wx:if="{{groupedMedicationRecords.length === 0}}">
            <view class="empty-text">æš‚æ— ç”¨è¯è®°å½•</view>
          </view>
        </view>
      </block>

      <block wx:else>
        <!-- å–‚å¥¶è®°å½•åˆ—è¡¨ -->
        <view class="card">
          <view class="card-title">
            <text>å–‚å¥¶è¯¦ç»†è®°å½•</text>
            <view class="add-btn" bindtap="showAddFeedingModal">
              <image class="add-icon" src="/images/icons/add.svg" mode="aspectFit"></image>
              <text>è¡¥å……è®°å½•</text>
            </view>
          </view>
          <view wx:if="{{feedingRecords.length > 0}}">
            <view class="feeding-record" wx:for="{{feedingRecords}}" wx:key="index">
              <view class="record-content" data-index="{{index}}">
                <feeding-record-item record="{{item}}" showLabel="{{false}}" />
              </view>
              <!-- æ“ä½œæŒ‰é’® -->
              <view class="action-buttons">
                <view class="action-btn edit-btn" bindtap="openEditFeedingModal" data-index="{{index}}">
                  <image class="action-icon" src="/images/icons/edit.svg" mode="aspectFit"></image>
                </view>
                <view class="action-btn delete-btn" bindtap="deleteFeeding" data-index="{{index}}">
                  <image class="action-icon" src="/images/icons/delete.svg" mode="aspectFit"></image>
                </view>
              </view>
            </view>
          </view>
          <view class="empty-data" wx:else>
            <view class="empty-text">æš‚æ— å–‚å¥¶è®°å½•</view>
          </view>
        </view>
      </block>
      <!-- æ’ä¾¿è®°å½•å¡ç‰‡ -->
      <view class="card" wx:if="{{bowelRecords.length > 0}}">
        <view class="card-title">
          <text>æ’ä¾¿è®°å½•</text>
          <view class="add-btn" bindtap="showAddBowelModal">
            <image class="add-icon" src="/images/icons/add.svg" mode="aspectFit"></image>
            <text>è¡¥å……è®°å½•</text>
          </view>
        </view>
        <view>
          <!-- æŒ‰ç±»å‹åˆ†ç»„æ˜¾ç¤º -->
          <view class="bowel-group" wx:for="{{groupedBowelRecords}}" wx:key="type" wx:for-item="group">
            <view class="bowel-group-header">
              <text class="bowel-group-name">{{group.typeText}}</text>
              <text class="bowel-group-count">{{group.count}}æ¬¡</text>
            </view>
            <!-- è¯¥ç±»å‹çš„æ‰€æœ‰è®°å½• -->
            <view class="bowel-group-records">
              <view class="bowel-record-item" wx:for="{{group.records}}" wx:key="_id" wx:for-item="record">
                <view class="record-content">
                  <view class="bowel-time-type">
                    <text class="bowel-time">{{record.timeString}}</text>
                  </view>
                  <!-- å¤§ä¾¿è¯¦ç»†ä¿¡æ¯ -->
                  <view class="bowel-details" wx:if="{{record.type === 'stool' || record.type === 'mixed'}}">
                    <text class="bowel-detail" wx:if="{{record.consistencyText}}">
                      {{record.consistencyText}}
                    </text>
                    <text class="bowel-detail" wx:if="{{record.colorText}}">
                      {{record.colorText}}
                    </text>
                    <text class="bowel-detail" wx:if="{{record.amountText}}">
                      {{record.amountText}}
                    </text>
                  </view>
                  <!-- å¤‡æ³¨ -->
                  <view class="bowel-notes" wx:if="{{record.notes}}">
                    <text class="notes-text">{{record.notes}}</text>
                  </view>
                </view>
                <!-- æ“ä½œæŒ‰é’® -->
                <view class="action-buttons">
                  <view class="action-btn edit-btn" bindtap="openEditBowelModal" data-record-id="{{record._id}}">
                    <image class="action-icon" src="/images/icons/edit.svg" mode="aspectFit"></image>
                  </view>
                  <view class="action-btn delete-btn" bindtap="deleteBowelRecord" data-record-id="{{record._id}}">
                    <image class="action-icon" src="/images/icons/delete.svg" mode="aspectFit"></image>
                  </view>
                </view>
              </view>
            </view>
          </view>
        </view>
      </view>
    </block>
  </view>
  <!-- æ—¥å†é€‰æ‹©å™¨ -->
  <view class="calendar-picker" wx:if="{{showCalendarPicker}}" bindtap="hideCalendar">
    <view class="calendar-content" catchtap="preventBubble">
      <view class="calendar-header">
        <view bindtap="prevMonth">ã€ˆ</view>
        <view class="month-title">{{calendarYear}}å¹´{{calendarMonth}}æœˆ</view>
        <view bindtap="nextMonth">ã€‰</view>
      </view>
      <view class="weekday-header">
        <view class="weekday-item" wx:for="{{['æ—¥','ä¸€','äºŒ','ä¸‰','å››','äº”','å…­']}}" wx:key="*this">
          {{item}}
        </view>
      </view>
      <view class="calendar-grid">
        <view class="calendar-day {{item.isCurrentMonth ? '' : 'other-month'}} {{item.date === selectedDate ? 'active' : ''}} {{item.isToday ? 'date-today' : ''}}" wx:for="{{calendarDays}}" wx:key="date" bindtap="{{item.isCurrentMonth ? 'selectCalendarDay' : ''}}" data-date="{{item.date}}">
          {{item.day}}
        </view>
      </view>
      <view class="calendar-footer">
        <view class="today-btn" bindtap="goToToday">ä»Šå¤©</view>
      </view>
    </view>
  </view>
  <!-- è¡¥å……å–‚å¥¶è®°å½•å¼¹çª— -->
  <feeding-modal
    visible="{{showAddFeedingModal}}"
    title="è¡¥å……å–‚å¥¶è®°å½•"
    feedingData="{{newFeedingDisplay}}"
    showGoalHint="{{false}}"
    confirmText="ä¿å­˜"
    bind:close="hideAddFeedingModal"
    bind:confirm="saveNewFeeding"
    bind:timechange="handleNewFeedingModalTimeChange"
    bind:inputchange="handleNewFeedingModalInputChange"
    bind:adjust="handleNewFeedingModalAdjust"
    bind:typechange="handleNewFeedingModalTypeChange"
  />
  <!-- é£Ÿç‰©æ‘„å…¥å¼¹çª— -->
  <view class="modal feeding-modal" wx:if="{{showFoodIntakeModal}}" bindtap="hideFoodIntakeModal" catchtouchmove="preventBubble">
    <view class="modal-content food-modal-content" catchtap="preventBubble">
      <view class="modal-header">
        <text>{{foodModalMode === 'edit' ? 'ç¼–è¾‘é£Ÿç‰©è®°å½•' : 'æ·»åŠ é£Ÿç‰©è®°å½•'}}</text>
      </view>
      <view class="modal-body">
        <view class="input-group">
          <text class="label">é£Ÿç‰©</text>
          <view class="food-selection-card">
            <view class="food-list-header">
              <view class="food-header-title">è¯·é€‰æ‹©é£Ÿç‰©</view>
              <view class="food-add-btn" bindtap="openFoodManage">
                <text class="food-add-icon">ï¼‹</text>
                <text>æ·»åŠ é£Ÿç‰©</text>
              </view>
            </view>
            <view class="food-search-input">
              <text class="search-icon">ğŸ”</text>
              <input type="text" value="{{foodSearchQuery}}" placeholder="æœç´¢é£Ÿç‰©åç§°æˆ–ç±»åˆ«" confirm-type="search" bindinput="onFoodSearchInput" />
            </view>
            <scroll-view class="food-option-list" scroll-y="true">
              <view class="food-option {{newFoodIntake.foodId === item._id ? 'selected' : ''}}"
                    wx:for="{{filteredFoodOptions}}" wx:key="_id"
                    data-id="{{item._id}}" bindtap="onFoodSelect">
                <view class="food-option-main">
                  <text class="food-option-name">{{item.name}}</text>
                  <text class="food-option-tag">{{item.category || 'æœªåˆ†ç±»'}}</text>
                </view>
                <text class="food-option-sub" wx:if="{{item.aliasText}}">{{item.aliasText}}</text>
              </view>
              <view class="food-option-empty" wx:if="{{filteredFoodOptions.length === 0}}">
                <text>æœªæ‰¾åˆ°åŒ¹é…çš„é£Ÿç‰©ï¼Œè¯·è°ƒæ•´æœç´¢æ¡ä»¶</text>
              </view>
            </scroll-view>
          </view>
        </view>
        <view class="input-group">
          <text class="label">ä»½é‡ ({{newFoodIntake.unit || 'g'}})</text>
          <input type="digit" value="{{newFoodIntake.quantity}}" bindinput="onFoodQuantityInput" placeholder="è¯·è¾“å…¥é‡é‡" />
        </view>
        <view class="input-group">
          <text class="label">è®°å½•æ—¶é—´</text>
          <picker mode="time" value="{{newFoodIntake.recordTime}}" bindchange="onFoodRecordTimeChange">
            <view class="picker-value">{{newFoodIntake.recordTime || 'é€‰æ‹©æ—¶é—´'}}</view>
          </picker>
        </view>
        <view class="nutrition-preview" wx:if="{{newFoodIntake.nutritionPreview}}">
          <view class="nutrition-item">
            <text>{{newFoodIntake.nutritionPreview.calories}} kcal</text>
            <text>çƒ­é‡</text>
          </view>
          <view class="nutrition-item">
            <text>{{newFoodIntake.nutritionPreview.protein}} g</text>
            <text>è›‹ç™½è´¨</text>
          </view>
          <view class="nutrition-item">
            <text>{{newFoodIntake.nutritionPreview.carbs}} g</text>
            <text>ç¢³æ°´</text>
          </view>
          <view class="nutrition-item">
            <text>{{newFoodIntake.nutritionPreview.fat}} g</text>
            <text>è„‚è‚ª</text>
          </view>
        </view>
      </view>
      <view class="modal-footer">
        <button class="modal-btn cancel" bindtap="hideFoodIntakeModal">å–æ¶ˆ</button>
        <button class="modal-btn confirm" bindtap="saveFoodIntake">ä¿å­˜</button>
      </view>
    </view>
  </view>
  <!-- é£Ÿç‰©æ‘„å…¥å®éªŒå¼¹çª— -->
  <food-intake-modal
    visible="{{showFoodIntakeExperimentModal}}"
    step="{{foodExperimentStep}}"
    searchQuery="{{foodExperimentSearchQuery}}"
    categories="{{foodExperimentCategories}}"
    activeCategory="{{foodExperimentCategory}}"
    options="{{filteredFoodExperimentOptions}}"
    selectedFoodId="{{foodExperiment.foodId}}"
    foodExperiment="{{foodExperiment}}"
    confirmDisabled="{{!foodExperiment.foodId}}"
    formCancelText="{{foodModalMode === 'edit' ? 'å–æ¶ˆ' : 'ä¸Šä¸€æ­¥'}}"
    bind:close="hideFoodIntakeExperimentModal"
    bind:openmanage="openFoodManage"
    bind:searchinput="onFoodExperimentSearchInput"
    bind:categorytap="onFoodExperimentCategorySelect"
    bind:optiontap="onFoodExperimentFoodSelect"
    bind:confirmselect="confirmFoodExperimentSelection"
    bind:backtoselect="backToFoodExperimentSelection"
    bind:quantityinput="onFoodExperimentQuantityInput"
    bind:timechange="onFoodExperimentRecordTimeChange"
    bind:formcancel="handleFoodExperimentFormCancel"
    bind:formsave="saveFoodIntakeExperiment"
  />
  <!-- è¡¥å……ç”¨è¯è®°å½•å¼¹çª— -->
  <view class="modal" wx:if="{{showAddMedicationModal}}" bindtap="hideAddMedicationModal">
    <view class="modal-content" catchtap="preventBubble">
      <view class="modal-header">
        <text>è¡¥å……ç”¨è¯è®°å½•</text>
      </view>
      <view class="modal-body">
        <view class="form-item">
          <text class="label">é€‰æ‹©è¯ç‰©</text>
          <picker mode="selector" range="{{medications}}" range-key="name" bindchange="onMedicationSelect">
            <view class="picker {{newMedication.name ? '' : 'placeholder'}}">
              {{newMedication.name || 'è¯·é€‰æ‹©è¯ç‰©'}}
            </view>
          </picker>
        </view>
        <view class="form-item">
          <text class="label">ç”¨è¯å‰‚é‡</text>
          <view class="dosage-input-container">
            <input type="digit" value="{{newMedication.dosage}}" data-field="dosage" bindinput="onNewMedicationInput" placeholder="è¯·è¾“å…¥å‰‚é‡" class="dosage-input" />
            <text class="unit-text">{{newMedication.unit}}</text>
          </view>
        </view>
        <view class="form-item">
          <text class="label">ç”¨è¯æ—¶é—´</text>
          <picker mode="time" value="{{newMedication.time}}" data-field="time" bindchange="onNewMedicationTimeChange">
            <view class="time-picker">{{newMedication.time}}</view>
          </picker>
        </view>
      </view>
      <view class="modal-footer">
        <button class="modal-btn cancel" bindtap="hideAddMedicationModal">å–æ¶ˆ</button>
        <button class="modal-btn confirm" bindtap="saveNewMedication">ä¿å­˜</button>
      </view>
    </view>
  </view>
  <!-- åˆ é™¤ç¡®è®¤å¼¹çª— -->
  <view class="confirm-modal" wx:if="{{showDeleteConfirm}}" bindtap="hideDeleteConfirm">
    <view class="confirm-modal-content" catchtap="preventBubble">
      <view class="confirm-modal-title">ç¡®è®¤åˆ é™¤</view>
      <view class="confirm-modal-message">{{deleteConfirmMessage}}</view>
      <view class="confirm-modal-footer">
        <view class="confirm-modal-btn cancel" bindtap="hideDeleteConfirm">å–æ¶ˆ</view>
        <view class="confirm-modal-btn confirm" bindtap="confirmDelete">åˆ é™¤</view>
      </view>
    </view>
  </view>
  <!-- ç¼–è¾‘å–‚å¥¶è®°å½•å¼¹çª— -->
  <feeding-modal
    visible="{{showEditFeedingModal}}"
    title="ç¼–è¾‘å–‚å¥¶è®°å½•"
    feedingData="{{editingFeedingDisplay}}"
    showGoalHint="{{false}}"
    confirmText="ä¿å­˜"
    bind:close="hideEditFeedingModal"
    bind:confirm="saveEditedFeeding"
    bind:timechange="handleEditFeedingModalTimeChange"
    bind:inputchange="handleEditFeedingModalInputChange"
    bind:adjust="handleEditFeedingModalAdjust"
    bind:typechange="handleEditFeedingModalTypeChange"
  />
  <!-- ç¼–è¾‘ç”¨è¯è®°å½•å¼¹çª— -->
  <view class="modal" wx:if="{{showEditMedicationModal}}" bindtap="hideEditMedicationModal">
    <view class="modal-content" catchtap="preventBubble">
      <view class="modal-header">
        <text>ç¼–è¾‘ç”¨è¯è®°å½•</text>
      </view>
      <view class="modal-body">
        <view class="form-item">
          <text class="label">è¯ç‰©åç§°</text>
          <view class="medication-name-display">{{editingMedication.medicationName}}</view>
        </view>
        <view class="form-item">
          <text class="label">ç”¨è¯å‰‚é‡</text>
          <view class="dosage-input-container">
            <input type="digit" value="{{editingMedication.dosage}}" data-field="dosage" bindinput="onEditMedicationInput" placeholder="è¯·è¾“å…¥å‰‚é‡" class="dosage-input" />
            <text class="unit-text">{{editingMedication.unit}}</text>
          </view>
        </view>
        <view class="form-item">
          <text class="label">ç”¨è¯æ—¶é—´</text>
          <picker mode="time" value="{{editingMedication.actualTime}}" data-field="actualTime" bindchange="onEditMedicationTimeChange">
            <view class="time-picker">{{editingMedication.actualTime}}</view>
          </picker>
        </view>
      </view>
      <view class="modal-footer">
        <button class="modal-btn cancel" bindtap="hideEditMedicationModal">å–æ¶ˆ</button>
        <button class="modal-btn confirm" bindtap="saveEditedMedication">ä¿å­˜</button>
      </view>
    </view>
  </view>
  <!-- è¡¥å……æ’ä¾¿è®°å½•å¼¹çª— -->
  <view class="modal" wx:if="{{showAddBowelModal}}" bindtap="hideAddBowelModal" catchtouchmove="preventBubble">
    <view class="modal-content" catchtap="preventBubble">
      <view class="modal-header">
        <text>è¡¥å……æ’ä¾¿è®°å½•</text>
      </view>
      <scroll-view class="modal-body" scroll-y="true" enhanced="true" show-scrollbar="false">
        <!-- æ—¶é—´é€‰æ‹© -->
        <view class="form-item">
          <text class="label">æ—¶é—´</text>
          <picker mode="time" value="{{newBowelRecord.time}}" bindchange="onNewBowelTimeChange">
            <view class="time-picker">{{newBowelRecord.time}}</view>
          </picker>
        </view>
        <!-- ç±»å‹é€‰æ‹© -->
        <view class="form-item">
          <text class="label">ç±»å‹</text>
          <view class="bowel-type-options">
            <view class="bowel-type-btn {{newBowelRecord.type === 'stool' ? 'active' : ''}}" data-type="stool" bindtap="onBowelTypeSelect">
              <text class="type-icon">ğŸ’©</text>
              <text class="type-text">å¤§ä¾¿</text>
            </view>
            <view class="bowel-type-btn {{newBowelRecord.type === 'urine' ? 'active' : ''}}" data-type="urine" bindtap="onBowelTypeSelect">
              <text class="type-icon">ğŸ’§</text>
              <text class="type-text">å°ä¾¿</text>
            </view>
            <view class="bowel-type-btn {{newBowelRecord.type === 'mixed' ? 'active' : ''}}" data-type="mixed" bindtap="onBowelTypeSelect">
              <text class="type-icon">ğŸš½</text>
              <text class="type-text">æ··åˆ</text>
            </view>
          </view>
        </view>
        <!-- å¤§ä¾¿è¯¦ç»†ä¿¡æ¯ -->
        <view wx:if="{{newBowelRecord.type === 'stool' || newBowelRecord.type === 'mixed'}}">
          <!-- æ€§çŠ¶ -->
          <view class="form-item">
            <text class="label">æ€§çŠ¶</text>
            <view class="option-grid">
              <view class="option-btn {{newBowelRecord.consistency === 'liquid' ? 'active' : ''}}" data-field="consistency" data-value="liquid" bindtap="onBowelOptionSelect">
                æ°´æ ·
              </view>
              <view class="option-btn {{newBowelRecord.consistency === 'loose' ? 'active' : ''}}" data-field="consistency" data-value="loose" bindtap="onBowelOptionSelect">
                ç¨€ä¾¿
              </view>
              <view class="option-btn {{newBowelRecord.consistency === 'soft' ? 'active' : ''}}" data-field="consistency" data-value="soft" bindtap="onBowelOptionSelect">
                ç³ŠçŠ¶
              </view>
              <view class="option-btn {{newBowelRecord.consistency === 'normal' ? 'active' : ''}}" data-field="consistency" data-value="normal" bindtap="onBowelOptionSelect">
                æ­£å¸¸
              </view>
              <view class="option-btn {{newBowelRecord.consistency === 'hard' ? 'active' : ''}}" data-field="consistency" data-value="hard" bindtap="onBowelOptionSelect">
                å¹²ç¡¬
              </view>
            </view>
          </view>
          <!-- é¢œè‰² -->
          <view class="form-item">
            <text class="label">é¢œè‰²</text>
            <view class="option-grid">
              <view class="option-btn {{newBowelRecord.color === 'yellow' ? 'active' : ''}}" data-field="color" data-value="yellow" bindtap="onBowelOptionSelect">
                é»„è‰²
              </view>
              <view class="option-btn {{newBowelRecord.color === 'green' ? 'active' : ''}}" data-field="color" data-value="green" bindtap="onBowelOptionSelect">
                ç»¿è‰²
              </view>
              <view class="option-btn {{newBowelRecord.color === 'brown' ? 'active' : ''}}" data-field="color" data-value="brown" bindtap="onBowelOptionSelect">
                è¤è‰²
              </view>
              <view class="option-btn {{newBowelRecord.color === 'white' ? 'active' : ''}}" data-field="color" data-value="white" bindtap="onBowelOptionSelect">
                ç™½è‰²
              </view>
              <view class="option-btn {{newBowelRecord.color === 'red' ? 'active' : ''}}" data-field="color" data-value="red" bindtap="onBowelOptionSelect">
                çº¢è‰²
              </view>
              <view class="option-btn {{newBowelRecord.color === 'black' ? 'active' : ''}}" data-field="color" data-value="black" bindtap="onBowelOptionSelect">
                é»‘è‰²
              </view>
            </view>
          </view>
          <!-- æ°”å‘³ -->
          <view class="form-item">
            <text class="label">æ°”å‘³</text>
            <view class="option-grid">
              <view class="option-btn {{newBowelRecord.smell === 'normal' ? 'active' : ''}}" data-field="smell" data-value="normal" bindtap="onBowelOptionSelect">
                æ­£å¸¸
              </view>
              <view class="option-btn {{newBowelRecord.smell === 'sour' ? 'active' : ''}}" data-field="smell" data-value="sour" bindtap="onBowelOptionSelect">
                é…¸è‡­
              </view>
              <view class="option-btn {{newBowelRecord.smell === 'fishy' ? 'active' : ''}}" data-field="smell" data-value="fishy" bindtap="onBowelOptionSelect">
                è…¥è‡­
              </view>
              <view class="option-btn {{newBowelRecord.smell === 'odorless' ? 'active' : ''}}" data-field="smell" data-value="odorless" bindtap="onBowelOptionSelect">
                æ— å‘³
              </view>
            </view>
          </view>
          <!-- åˆ†é‡ -->
          <view class="form-item">
            <text class="label">åˆ†é‡</text>
            <view class="option-grid">
              <view class="option-btn {{newBowelRecord.amount === 'small' ? 'active' : ''}}" data-field="amount" data-value="small" bindtap="onBowelOptionSelect">
                å°‘é‡
              </view>
              <view class="option-btn {{newBowelRecord.amount === 'medium' ? 'active' : ''}}" data-field="amount" data-value="medium" bindtap="onBowelOptionSelect">
                é€‚é‡
              </view>
              <view class="option-btn {{newBowelRecord.amount === 'large' ? 'active' : ''}}" data-field="amount" data-value="large" bindtap="onBowelOptionSelect">
                å¤§é‡
              </view>
            </view>
          </view>
        </view>
        <!-- å¤‡æ³¨ -->
        <view class="form-item">
          <text class="label">å¤‡æ³¨</text>
          <textarea value="{{newBowelRecord.notes}}" data-field="notes" bindinput="onNewBowelInput" placeholder="å¯é€‰ï¼Œè®°å½•å…¶ä»–ä¿¡æ¯" class="notes-textarea" />
        </view>
      </scroll-view>
      <view class="modal-footer">
        <button class="modal-btn cancel" bindtap="hideAddBowelModal">å–æ¶ˆ</button>
        <button class="modal-btn confirm" bindtap="saveNewBowelRecord">ä¿å­˜</button>
      </view>
    </view>
  </view>
  <!-- ç¼–è¾‘æ’ä¾¿è®°å½•å¼¹çª— -->
  <view class="modal" wx:if="{{showEditBowelModal}}" bindtap="hideEditBowelModal" catchtouchmove="preventBubble">
    <view class="modal-content" catchtap="preventBubble">
      <view class="modal-header">
        <text>ç¼–è¾‘æ’ä¾¿è®°å½•</text>
      </view>
      <scroll-view class="modal-body" scroll-y="true" enhanced="true" show-scrollbar="false">
        <!-- æ—¶é—´é€‰æ‹© -->
        <view class="form-item">
          <text class="label">æ—¶é—´</text>
          <picker mode="time" value="{{editingBowelRecord.timeString}}" bindchange="onEditBowelTimeChange">
            <view class="time-picker">{{editingBowelRecord.timeString}}</view>
          </picker>
        </view>
        <!-- ç±»å‹é€‰æ‹© -->
        <view class="form-item">
          <text class="label">ç±»å‹</text>
          <view class="bowel-type-options">
            <view class="bowel-type-btn {{editingBowelRecord.type === 'stool' ? 'active' : ''}}" data-type="stool" bindtap="onEditBowelTypeSelect">
              <text class="type-icon">ğŸ’©</text>
              <text class="type-text">å¤§ä¾¿</text>
            </view>
            <view class="bowel-type-btn {{editingBowelRecord.type === 'urine' ? 'active' : ''}}" data-type="urine" bindtap="onEditBowelTypeSelect">
              <text class="type-icon">ğŸ’§</text>
              <text class="type-text">å°ä¾¿</text>
            </view>
            <view class="bowel-type-btn {{editingBowelRecord.type === 'mixed' ? 'active' : ''}}" data-type="mixed" bindtap="onEditBowelTypeSelect">
              <text class="type-icon">ğŸš½</text>
              <text class="type-text">æ··åˆ</text>
            </view>
          </view>
        </view>
        <!-- å¤§ä¾¿è¯¦ç»†ä¿¡æ¯ -->
        <view wx:if="{{editingBowelRecord.type === 'stool' || editingBowelRecord.type === 'mixed'}}">
          <!-- æ€§çŠ¶ -->
          <view class="form-item">
            <text class="label">æ€§çŠ¶</text>
            <view class="option-grid">
              <view class="option-btn {{editingBowelRecord.consistency === 'liquid' ? 'active' : ''}}" data-field="consistency" data-value="liquid" bindtap="onEditBowelOptionSelect">
                æ°´æ ·
              </view>
              <view class="option-btn {{editingBowelRecord.consistency === 'loose' ? 'active' : ''}}" data-field="consistency" data-value="loose" bindtap="onEditBowelOptionSelect">
                ç¨€ä¾¿
              </view>
              <view class="option-btn {{editingBowelRecord.consistency === 'soft' ? 'active' : ''}}" data-field="consistency" data-value="soft" bindtap="onEditBowelOptionSelect">
                ç³ŠçŠ¶
              </view>
              <view class="option-btn {{editingBowelRecord.consistency === 'normal' ? 'active' : ''}}" data-field="consistency" data-value="normal" bindtap="onEditBowelOptionSelect">
                æ­£å¸¸
              </view>
              <view class="option-btn {{editingBowelRecord.consistency === 'hard' ? 'active' : ''}}" data-field="consistency" data-value="hard" bindtap="onEditBowelOptionSelect">
                å¹²ç¡¬
              </view>
            </view>
          </view>
          <!-- é¢œè‰² -->
          <view class="form-item">
            <text class="label">é¢œè‰²</text>
            <view class="option-grid">
              <view class="option-btn {{editingBowelRecord.color === 'yellow' ? 'active' : ''}}" data-field="color" data-value="yellow" bindtap="onEditBowelOptionSelect">
                é»„è‰²
              </view>
              <view class="option-btn {{editingBowelRecord.color === 'green' ? 'active' : ''}}" data-field="color" data-value="green" bindtap="onEditBowelOptionSelect">
                ç»¿è‰²
              </view>
              <view class="option-btn {{editingBowelRecord.color === 'brown' ? 'active' : ''}}" data-field="color" data-value="brown" bindtap="onEditBowelOptionSelect">
                è¤è‰²
              </view>
              <view class="option-btn {{editingBowelRecord.color === 'white' ? 'active' : ''}}" data-field="color" data-value="white" bindtap="onEditBowelOptionSelect">
                ç™½è‰²
              </view>
              <view class="option-btn {{editingBowelRecord.color === 'red' ? 'active' : ''}}" data-field="color" data-value="red" bindtap="onEditBowelOptionSelect">
                çº¢è‰²
              </view>
              <view class="option-btn {{editingBowelRecord.color === 'black' ? 'active' : ''}}" data-field="color" data-value="black" bindtap="onEditBowelOptionSelect">
                é»‘è‰²
              </view>
            </view>
          </view>
          <!-- æ°”å‘³ -->
          <view class="form-item">
            <text class="label">æ°”å‘³</text>
            <view class="option-grid">
              <view class="option-btn {{editingBowelRecord.smell === 'normal' ? 'active' : ''}}" data-field="smell" data-value="normal" bindtap="onEditBowelOptionSelect">
                æ­£å¸¸
              </view>
              <view class="option-btn {{editingBowelRecord.smell === 'sour' ? 'active' : ''}}" data-field="smell" data-value="sour" bindtap="onEditBowelOptionSelect">
                é…¸è‡­
              </view>
              <view class="option-btn {{editingBowelRecord.smell === 'fishy' ? 'active' : ''}}" data-field="smell" data-value="fishy" bindtap="onEditBowelOptionSelect">
                è…¥è‡­
              </view>
              <view class="option-btn {{editingBowelRecord.smell === 'odorless' ? 'active' : ''}}" data-field="smell" data-value="odorless" bindtap="onEditBowelOptionSelect">
                æ— å‘³
              </view>
            </view>
          </view>
          <!-- åˆ†é‡ -->
          <view class="form-item">
            <text class="label">åˆ†é‡</text>
            <view class="option-grid">
              <view class="option-btn {{editingBowelRecord.amount === 'small' ? 'active' : ''}}" data-field="amount" data-value="small" bindtap="onEditBowelOptionSelect">
                å°‘é‡
              </view>
              <view class="option-btn {{editingBowelRecord.amount === 'medium' ? 'active' : ''}}" data-field="amount" data-value="medium" bindtap="onEditBowelOptionSelect">
                é€‚é‡
              </view>
              <view class="option-btn {{editingBowelRecord.amount === 'large' ? 'active' : ''}}" data-field="amount" data-value="large" bindtap="onEditBowelOptionSelect">
                å¤§é‡
              </view>
            </view>
          </view>
        </view>
        <!-- å¤‡æ³¨ -->
        <view class="form-item">
          <text class="label">å¤‡æ³¨</text>
          <textarea value="{{editingBowelRecord.notes}}" data-field="notes" bindinput="onEditBowelInput" placeholder="å¯é€‰ï¼Œè®°å½•å…¶ä»–ä¿¡æ¯" class="notes-textarea" />
        </view>
      </scroll-view>
      <view class="modal-footer">
        <button class="modal-btn cancel" bindtap="hideEditBowelModal">å–æ¶ˆ</button>
        <button class="modal-btn confirm" bindtap="saveEditedBowelRecord">ä¿å­˜</button>
      </view>
    </view>
  </view>
</view>
