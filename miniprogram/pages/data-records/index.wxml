<view class="container">
  <!-- æ—¥æœŸé€‰æ‹©å™¨ -->
  <view class="date-selector">
    <!-- å½“å‰æ—¥æœŸæ˜¾ç¤º -->
    <view class="current-date">
      <text class="date-text">{{todayFullDate}}</text>
    </view>
    <!-- æ—¥æœŸæ»‘åŠ¨åŒºåŸŸ1 -->
    <view class="date-scroll-container">
      <scroll-view scroll-x="true" scroll-into-view="{{currentDateId}}" scroll-with-animation="true" class="date-list" enhanced="true" show-scrollbar="false" enable-flex="{{false}}" bounces="{{true}}" fast-deceleration="{{true}}">
        <view class="date-items-container">
          <view id="date-{{index}}" class="date-item {{selectedDateIndex === index ? 'selected' : ''}} {{index === 0 ? 'today' : ''}}" wx:for="{{dateList}}" wx:key="date" data-date="{{item.date}}" data-index="{{index}}" bindtap="onDateItemClick">
            <text class="weekday">{{item.weekday}}</text>
            <text class="day">{{item.day}}</text>
            <text class="month">{{item.month}}æœˆ</text>
          </view>
          <view class="date-more-indicator" bindtap="showCalendar">
            <text>æ›´å¤š</text>
          </view>
        </view>
      </scroll-view>
    </view>
  </view>
  <!-- è®°å½•å†…å®¹åŒºåŸŸ -->
  <view class="records-wrapper" style="opacity: {{isDataLoading ? 0.5 : 1}};">
    <!-- æ—¥æœŸæ˜¾ç¤ºå¤´éƒ¨ -->
    <view class="date-header">
      <view class="selected-date">{{formattedSelectedDate}}</view>
      <view class="calendar-icon" bindtap="showCalendar">æ—¥å†</view>
    </view>
    <!-- æ— è®°å½•æç¤º -->
    <view class="empty-data" wx:if="{{feedingRecords.length === 0 && medicationRecords.length === 0 && bowelRecords.length === 0}}" style="opacity: {{isDataLoading ? 0.5 : 1}}; transition: opacity 0.3s;">
      <view class="empty-icon">ğŸ“</view>
      <view class="empty-text">å½“æ—¥æš‚æ— è®°å½•</view>
      <view class="empty-actions">
        <view class="add-btn" bindtap="showAddFeedingModal">
          <image class="add-icon" src="/images/icons/add.svg" mode="aspectFit"></image>
          <text>è¡¥å……å–‚å¥¶è®°å½•</text>
        </view>
        <view class="add-btn" bindtap="showAddMedicationModal">
          <image class="add-icon" src="/images/icons/add.svg" mode="aspectFit"></image>
          <text>è¡¥å……ç”¨è¯è®°å½•</text>
        </view>
        <view class="add-btn" bindtap="showAddBowelModal">
          <image class="add-icon" src="/images/icons/add.svg" mode="aspectFit"></image>
          <text>è¡¥å……æ’ä¾¿è®°å½•</text>
        </view>
      </view>
    </view>
    <!-- æœ‰è®°å½•æ—¶æ˜¾ç¤ºå†…å®¹ -->
    <block wx:else>
      <!-- å–‚å¥¶è®°å½•æ±‡æ€»å¡ç‰‡ -->
      <view class="card">
        <view class="card-title">
          <text>æ±‡æ€»ä¿¡æ¯</text>
        </view>
        <!-- ç”Ÿé•¿ä¿¡æ¯ -->
        <view class="growth-info">
          <view class="growth-item">
            <view class="growth-label">ä½“é‡</view>
            <view class="growth-value">
              <input class="weight-input" type="digit" value="{{weight}}" placeholder="è¯·è¾“å…¥ä½“é‡" bindinput="onWeightInput" bindblur="onWeightBlur" />
              <text class="unit">kg</text>
            </view>
          </view>
          <view class="growth-item">
            <view class="growth-label">èº«é«˜</view>
            <view class="growth-value">{{height}} cm</view>
          </view>
        </view>
        <!-- å–‚å¥¶ä¿¡æ¯ -->
        <view class="total-summary">
          <view class="total-item">
            <view class="total-label">æ€»å¥¶é‡</view>
            <view class="total-value">{{totalMilk}}ml</view>
          </view>
          <view class="total-item">
            <view class="total-label">å–‚å¥¶æ¬¡æ•°</view>
            <view class="total-value">{{feedingRecords.length}}</view>
          </view>
          <view class="total-item">
            <view class="total-label">å¤©ç„¶å¥¶æ€»é‡</view>
            <view class="total-value">{{totalNaturalMilk}}ml</view>
          </view>
          <!-- å¦‚æœæ˜¯æ™®é€šå¥¶ç²‰ï¼Œæ˜¾ç¤ºå¥¶ç²‰é‡é‡ç»Ÿè®¡ -->
          <view class="total-item" wx:if="{{proteinSourceType === 'formulaMilk'}}">
            <view class="total-label">å¥¶ç²‰æ€»é‡é‡</view>
            <view class="total-value">{{totalFormulaPowderWeight || '0'}}g</view>
          </view>
          <view class="total-item">
            <view class="total-label">ç‰¹å¥¶æ€»é‡</view>
            <view class="total-value">{{totalSpecialMilk}}ml</view>
          </view>
          <view class="total-item">
            <view class="total-label">å¤©ç„¶ç³»æ•°</view>
            <view class="total-value">{{naturalProteinCoefficient}}g/kg</view>
          </view>
          <view class="total-item">
            <view class="total-label">ç‰¹æ®Šè›‹ç™½ç³»æ•°</view>
            <view class="total-value">{{specialProteinCoefficient}}g/kg</view>
          </view>
          <view class="total-item">
            <view class="total-label">æ¯ä¹³çƒ­é‡</view>
            <view class="total-value">{{totalBreastMilkKcal}}kcal</view>
          </view>
          <view class="total-item">
            <view class="total-label">ç‰¹å¥¶çƒ­é‡</view>
            <view class="total-value">{{totalSpecialMilkKcal}}kcal</view>
          </view>
          <view class="total-item">
            <view class="total-label">æ€»çƒ­é‡</view>
            <view class="total-value">{{totalBreastMilkKcal + totalSpecialMilkKcal}}kcal</view>
          </view>
          <view class="total-item">
            <view class="total-label">ç›®æ ‡çƒ­é‡</view>
            <view class="total-value">{{goalKcalRange.min}}~{{goalKcalRange.max}}kcal</view>
          </view>
        </view>
      </view>
      <!-- é£Ÿç‰©æ‘„å…¥å¡ç‰‡ -->
      <view class="card">
        <view class="card-title">
          <text>é£Ÿç‰©æ‘„å…¥</text>
        </view>
        <view class="total-summary">
          <view class="total-item">
            <view class="total-label">çƒ­é‡</view>
            <view class="total-value">{{macroSummary.calories || 0}} kcal</view>
          </view>
          <view class="total-item">
            <view class="total-label">æ€»è›‹ç™½</view>
            <view class="total-value">{{macroSummary.protein || 0}} g</view>
          </view>
          <view class="total-item">
            <view class="total-label">å¤©ç„¶è›‹ç™½</view>
            <view class="total-value">{{macroSummary.naturalProtein || 0}} g</view>
          </view>
          <view class="total-item">
            <view class="total-label">ç‰¹æ®Šè›‹ç™½</view>
            <view class="total-value">{{macroSummary.specialProtein || 0}} g</view>
          </view>
        </view>
        <view class="intake-list" wx:if="{{foodIntakes.length > 0}}">
          <view class="intake-item" wx:for="{{foodIntakes}}" wx:key="_id">
            <view class="intake-header">
              <text class="intake-time">{{item.recordedAt}}</text>
              <text class="intake-name">{{item.nameSnapshot}}</text>
            </view>
            <view class="intake-detail">
              <text class="detail">{{item.quantity}}{{item.unit || 'g'}}</text>
              <text class="divider">|</text>
              <text class="detail">çƒ­é‡ {{item.nutrition.calories || 0}} kcal</text>
              <text class="divider">|</text>
              <text class="detail">è›‹ç™½ {{item.nutrition.protein || 0}} g</text>
              <text class="divider">|</text>
              <text class="detail">ç¢³æ°´ {{item.nutrition.carbs || 0}} g</text>
              <text class="divider">|</text>
              <text class="detail">è„‚è‚ª {{item.nutrition.fat || 0}} g</text>
              <text class="divider">|</text>
              <text class="detail">è†³çº¤ {{item.nutrition.fiber || 0}} g</text>
              <text class="divider">|</text>
              <text class="detail">é’  {{item.nutrition.sodium || 0}} mg</text>
            </view>
            <view class="intake-tags">
              <text class="tag {{item.proteinSource === 'special' ? 'special' : 'natural'}}">
                {{item.proteinSource === 'special' ? 'ç‰¹æ®Šè›‹ç™½' : 'å¤©ç„¶è›‹ç™½'}}
              </text>
            </view>
          </view>
        </view>
        <view class="empty-data" wx:if="{{foodIntakes.length === 0}}">
          <view class="empty-text">æš‚æ— é£Ÿç‰©è®°å½•</view>
        </view>
      </view>
      <!-- å–‚å¥¶è®°å½•åˆ—è¡¨ -->
      <view class="card">
        <view class="card-title">
          <text>å–‚å¥¶è¯¦ç»†è®°å½•</text>
          <view class="add-btn" bindtap="showAddFeedingModal">
            <image class="add-icon" src="/images/icons/add.svg" mode="aspectFit"></image>
            <text>è¡¥å……è®°å½•</text>
          </view>
        </view>
        <view wx:if="{{feedingRecords.length > 0}}">
          <view class="feeding-record" wx:for="{{feedingRecords}}" wx:key="index">
            <view class="record-content" data-index="{{index}}">
              <view class="time-info">
                <view class="time-text">{{item.formattedStartTime || '--:--'}}</view>
              </view>
              <view class="volume-info">
                <view class="volume-info-text">å¤©ç„¶å¥¶: {{item.naturalMilkVolume || 0}}ml</view>
                <!-- å¦‚æœæ˜¯æ™®é€šå¥¶ç²‰ï¼Œæ˜¾ç¤ºå¥¶ç²‰é‡é‡ -->
                <view class="volume-info-text" wx:if="{{proteinSourceType === 'formulaMilk'}}">
                  |
                </view>
                <view class="volume-info-text" wx:if="{{proteinSourceType === 'formulaMilk'}}">
                  å¥¶ç²‰: {{item.formulaPowderWeight || 0}}g
                </view>
                <view class="volume-info-text">|</view>
                <view class="volume-info-text">ç‰¹å¥¶: {{item.specialMilkVolume || 0}}ml</view>
              </view>
            </view>
            <!-- æ“ä½œæŒ‰é’® -->
            <view class="action-buttons">
              <view class="action-btn edit-btn" bindtap="openEditFeedingModal" data-index="{{index}}">
                <image class="action-icon" src="/images/icons/edit.svg" mode="aspectFit"></image>
              </view>
              <view class="action-btn delete-btn" bindtap="deleteFeeding" data-index="{{index}}">
                <image class="action-icon" src="/images/icons/delete.svg" mode="aspectFit"></image>
              </view>
            </view>
          </view>
        </view>
        <view class="empty-data" wx:else>
          <view class="empty-text">æš‚æ— å–‚å¥¶è®°å½•</view>
        </view>
      </view>
      <!-- ç”¨è¯è®°å½•å¡ç‰‡ -->
      <view class="card" wx:if="{{groupedMedicationRecords.length > 0}}">
        <view class="card-title">
          <text>ç”¨è¯è®°å½•</text>
          <view class="add-btn" bindtap="showAddMedicationModal">
            <image class="add-icon" src="/images/icons/add.svg" mode="aspectFit"></image>
            <text>è¡¥å……è®°å½•</text>
          </view>
        </view>
        <view>
          <!-- æŒ‰è¯ç‰©åç§°åˆ†ç»„æ˜¾ç¤º -->
          <view class="medication-group" wx:for="{{groupedMedicationRecords}}" wx:key="medicationName" wx:for-item="group">
            <view class="medication-group-header">
              <text class="medication-group-name">{{group.medicationName}}</text>
              <text class="medication-group-count">ä»Šæ—¥{{group.totalCount}}æ¬¡</text>
            </view>
            <!-- è¯¥è¯ç‰©çš„æ‰€æœ‰è®°å½• -->
            <view class="medication-group-records">
              <view class="medication-record-item" wx:for="{{group.records}}" wx:key="_id" wx:for-item="record">
                <view class="record-content">
                  <view class="medication-time-dose">
                    <text class="medication-time">{{record.actualTime}}</text>
                    <text class="medication-volume">{{record.dosage}}{{record.unit}}</text>
                  </view>
                </view>
                <!-- æ“ä½œæŒ‰é’® -->
                <view class="action-buttons">
                  <view class="action-btn edit-btn" bindtap="openEditMedicationModal" data-record-id="{{record._id}}">
                    <image class="action-icon" src="/images/icons/edit.svg" mode="aspectFit"></image>
                  </view>
                  <view class="action-btn delete-btn" bindtap="deleteMedication" data-record-id="{{record._id}}">
                    <image class="action-icon" src="/images/icons/delete.svg" mode="aspectFit"></image>
                  </view>
                </view>
              </view>
            </view>
          </view>
        </view>
      </view>
      <!-- æ’ä¾¿è®°å½•å¡ç‰‡ -->
      <view class="card" wx:if="{{bowelRecords.length > 0}}">
        <view class="card-title">
          <text>æ’ä¾¿è®°å½•</text>
          <view class="add-btn" bindtap="showAddBowelModal">
            <image class="add-icon" src="/images/icons/add.svg" mode="aspectFit"></image>
            <text>è¡¥å……è®°å½•</text>
          </view>
        </view>
        <view>
          <!-- æŒ‰ç±»å‹åˆ†ç»„æ˜¾ç¤º -->
          <view class="bowel-group" wx:for="{{groupedBowelRecords}}" wx:key="type" wx:for-item="group">
            <view class="bowel-group-header">
              <text class="bowel-group-name">{{group.typeText}}</text>
              <text class="bowel-group-count">{{group.count}}æ¬¡</text>
            </view>
            <!-- è¯¥ç±»å‹çš„æ‰€æœ‰è®°å½• -->
            <view class="bowel-group-records">
              <view class="bowel-record-item" wx:for="{{group.records}}" wx:key="_id" wx:for-item="record">
                <view class="record-content">
                  <view class="bowel-time-type">
                    <text class="bowel-time">{{record.timeString}}</text>
                  </view>
                  <!-- å¤§ä¾¿è¯¦ç»†ä¿¡æ¯ -->
                  <view class="bowel-details" wx:if="{{record.type === 'stool' || record.type === 'mixed'}}">
                    <text class="bowel-detail" wx:if="{{record.consistencyText}}">
                      {{record.consistencyText}}
                    </text>
                    <text class="bowel-detail" wx:if="{{record.colorText}}">
                      {{record.colorText}}
                    </text>
                    <text class="bowel-detail" wx:if="{{record.amountText}}">
                      {{record.amountText}}
                    </text>
                  </view>
                  <!-- å¤‡æ³¨ -->
                  <view class="bowel-notes" wx:if="{{record.notes}}">
                    <text class="notes-text">{{record.notes}}</text>
                  </view>
                </view>
                <!-- æ“ä½œæŒ‰é’® -->
                <view class="action-buttons">
                  <view class="action-btn edit-btn" bindtap="openEditBowelModal" data-record-id="{{record._id}}">
                    <image class="action-icon" src="/images/icons/edit.svg" mode="aspectFit"></image>
                  </view>
                  <view class="action-btn delete-btn" bindtap="deleteBowelRecord" data-record-id="{{record._id}}">
                    <image class="action-icon" src="/images/icons/delete.svg" mode="aspectFit"></image>
                  </view>
                </view>
              </view>
            </view>
          </view>
        </view>
      </view>
    </block>
  </view>
  <!-- æ—¥å†é€‰æ‹©å™¨ -->
  <view class="calendar-picker" wx:if="{{showCalendarPicker}}" bindtap="hideCalendar">
    <view class="calendar-content" catchtap="preventBubble">
      <view class="calendar-header">
        <view bindtap="prevMonth">ã€ˆ</view>
        <view class="month-title">{{calendarYear}}å¹´{{calendarMonth}}æœˆ</view>
        <view bindtap="nextMonth">ã€‰</view>
      </view>
      <view class="weekday-header">
        <view class="weekday-item" wx:for="{{['æ—¥','ä¸€','äºŒ','ä¸‰','å››','äº”','å…­']}}" wx:key="*this">
          {{item}}
        </view>
      </view>
      <view class="calendar-grid">
        <view class="calendar-day {{item.isCurrentMonth ? '' : 'other-month'}} {{item.date === selectedDate ? 'active' : ''}} {{item.isToday ? 'date-today' : ''}}" wx:for="{{calendarDays}}" wx:key="date" bindtap="{{item.isCurrentMonth ? 'selectCalendarDay' : ''}}" data-date="{{item.date}}">
          {{item.day}}
        </view>
      </view>
      <view class="calendar-footer">
        <view class="today-btn" bindtap="goToToday">ä»Šå¤©</view>
      </view>
    </view>
  </view>
  <!-- è¡¥å……å–‚å¥¶è®°å½•å¼¹çª— -->
  <view class="modal" wx:if="{{showAddFeedingModal}}" bindtap="hideAddFeedingModal">
    <view class="modal-content" catchtap="preventBubble">
      <view class="modal-header">
        <text>è¡¥å……å–‚å¥¶è®°å½•</text>
      </view>
      <view class="modal-body">
        <!-- æ—¶é—´é€‰æ‹© -->
        <view class="time-selection">
          <view class="time-picker-group">
            <text class="label">å–‚å¥¶æ—¶é—´</text>
            <picker mode="time" value="{{newFeeding.startTime}}" data-field="startTime" bindchange="onNewFeedingTimeChange">
              <view class="time-picker">{{newFeeding.startTime}}</view>
            </picker>
          </view>
        </view>
        <!-- å¤©ç„¶å¥¶é‡ -->
        <view class="input-group">
          <text class="label">å¤©ç„¶å¥¶é‡ (ml)</text>
          <input type="digit" value="{{newFeeding.naturalMilkVolume}}" data-field="naturalMilkVolume" bindinput="onNewFeedingInput" placeholder="è¯·è¾“å…¥å¤©ç„¶å¥¶é‡" />
        </view>
        <!-- å¦‚æœæ˜¯æ™®é€šå¥¶ç²‰ï¼Œæ˜¾ç¤ºå¥¶ç²‰é‡é‡ -->
        <view class="input-group" wx:if="{{proteinSourceType === 'formulaMilk'}}">
          <text class="label">å¥¶ç²‰é‡é‡</text>
          <view class="display-value">{{newFeeding.formulaPowderWeight || '0'}}g</view>
        </view>
        <!-- ç‰¹å¥¶é‡ -->
        <view class="input-group">
          <text class="label">ç‰¹å¥¶é‡ (ml)</text>
          <input type="digit" value="{{newFeeding.specialMilkVolume}}" data-field="specialMilkVolume" bindinput="onNewFeedingInput" placeholder="è¯·è¾“å…¥ç‰¹å¥¶é‡" />
        </view>
        <!-- è®¡ç®—ç»“æœå±•ç¤º -->
        <view class="special-milk">
          <text class="label">æ€»å¥¶é‡:</text>
          <text class="value">{{newFeeding.totalVolume || '0'}}ml</text>
          <text class="powder-weight">(ç‰¹å¥¶ç²‰ {{newFeeding.specialPowderWeight || '0'}}g)</text>
        </view>
      </view>
      <view class="modal-footer">
        <button class="modal-btn cancel" bindtap="hideAddFeedingModal">å–æ¶ˆ</button>
        <button class="modal-btn confirm" bindtap="saveNewFeeding">ä¿å­˜</button>
      </view>
    </view>
  </view>
  <!-- è¡¥å……ç”¨è¯è®°å½•å¼¹çª— -->
  <view class="modal" wx:if="{{showAddMedicationModal}}" bindtap="hideAddMedicationModal">
    <view class="modal-content" catchtap="preventBubble">
      <view class="modal-header">
        <text>è¡¥å……ç”¨è¯è®°å½•</text>
      </view>
      <view class="modal-body">
        <view class="form-item">
          <text class="label">é€‰æ‹©è¯ç‰©</text>
          <picker mode="selector" range="{{medications}}" range-key="name" bindchange="onMedicationSelect">
            <view class="picker {{newMedication.name ? '' : 'placeholder'}}">
              {{newMedication.name || 'è¯·é€‰æ‹©è¯ç‰©'}}
            </view>
          </picker>
        </view>
        <view class="form-item">
          <text class="label">ç”¨è¯å‰‚é‡</text>
          <view class="dosage-input-container">
            <input type="digit" value="{{newMedication.dosage}}" data-field="dosage" bindinput="onNewMedicationInput" placeholder="è¯·è¾“å…¥å‰‚é‡" class="dosage-input" />
            <text class="unit-text">{{newMedication.unit}}</text>
          </view>
        </view>
        <view class="form-item">
          <text class="label">ç”¨è¯æ—¶é—´</text>
          <picker mode="time" value="{{newMedication.time}}" data-field="time" bindchange="onNewMedicationTimeChange">
            <view class="time-picker">{{newMedication.time}}</view>
          </picker>
        </view>
      </view>
      <view class="modal-footer">
        <button class="modal-btn cancel" bindtap="hideAddMedicationModal">å–æ¶ˆ</button>
        <button class="modal-btn confirm" bindtap="saveNewMedication">ä¿å­˜</button>
      </view>
    </view>
  </view>
  <!-- åˆ é™¤ç¡®è®¤å¼¹çª— -->
  <view class="confirm-modal" wx:if="{{showDeleteConfirm}}" bindtap="hideDeleteConfirm">
    <view class="confirm-modal-content" catchtap="preventBubble">
      <view class="confirm-modal-title">ç¡®è®¤åˆ é™¤</view>
      <view class="confirm-modal-message">{{deleteConfirmMessage}}</view>
      <view class="confirm-modal-footer">
        <view class="confirm-modal-btn cancel" bindtap="hideDeleteConfirm">å–æ¶ˆ</view>
        <view class="confirm-modal-btn confirm" bindtap="confirmDelete">åˆ é™¤</view>
      </view>
    </view>
  </view>
  <!-- ç¼–è¾‘å–‚å¥¶è®°å½•å¼¹çª— -->
  <view class="modal" wx:if="{{showEditFeedingModal}}" bindtap="hideEditFeedingModal">
    <view class="modal-content" catchtap="preventBubble">
      <view class="modal-header">
        <text>ç¼–è¾‘å–‚å¥¶è®°å½•</text>
      </view>
      <view class="modal-body">
        <!-- æ—¶é—´é€‰æ‹© -->
        <view class="time-selection">
          <view class="time-picker-group">
            <text class="label">å–‚å¥¶æ—¶é—´</text>
            <picker mode="time" value="{{editingFeeding.formattedStartTime}}" data-field="formattedStartTime" bindchange="onEditFeedingTimeChange">
              <view class="time-picker">{{editingFeeding.formattedStartTime}}</view>
            </picker>
          </view>
        </view>
        <!-- å¤©ç„¶å¥¶é‡ -->
        <view class="input-group">
          <text class="label">å¤©ç„¶å¥¶é‡ (ml)</text>
          <input type="digit" value="{{editingFeeding.naturalMilkVolume}}" data-field="naturalMilkVolume" bindinput="onEditFeedingInput" placeholder="è¯·è¾“å…¥å¤©ç„¶å¥¶é‡" />
        </view>
        <!-- å¦‚æœæ˜¯æ™®é€šå¥¶ç²‰ï¼Œæ˜¾ç¤ºå¥¶ç²‰é‡é‡ -->
        <view class="input-group" wx:if="{{proteinSourceType === 'formulaMilk'}}">
          <text class="label">å¥¶ç²‰é‡é‡</text>
          <view class="display-value">{{editingFeeding.formulaPowderWeight || '0'}}g</view>
        </view>
        <!-- ç‰¹å¥¶é‡ -->
        <view class="input-group">
          <text class="label">ç‰¹å¥¶é‡ (ml)</text>
          <input type="digit" value="{{editingFeeding.specialMilkVolume}}" data-field="specialMilkVolume" bindinput="onEditFeedingInput" placeholder="è¯·è¾“å…¥ç‰¹å¥¶é‡" />
        </view>
        <!-- è®¡ç®—ç»“æœå±•ç¤º -->
        <view class="special-milk">
          <text class="label">æ€»å¥¶é‡:</text>
          <text class="value">
            {{editingFeeding.totalVolume || ((editingFeeding.naturalMilkVolume || 0) + (editingFeeding.specialMilkVolume || 0))}}ml
          </text>
          <text class="powder-weight">(ç‰¹å¥¶ç²‰ {{editingFeeding.specialPowderWeight || '0'}}g)</text>
        </view>
      </view>
      <view class="modal-footer">
        <button class="modal-btn cancel" bindtap="hideEditFeedingModal">å–æ¶ˆ</button>
        <button class="modal-btn confirm" bindtap="saveEditedFeeding">ä¿å­˜</button>
      </view>
    </view>
  </view>
  <!-- ç¼–è¾‘ç”¨è¯è®°å½•å¼¹çª— -->
  <view class="modal" wx:if="{{showEditMedicationModal}}" bindtap="hideEditMedicationModal">
    <view class="modal-content" catchtap="preventBubble">
      <view class="modal-header">
        <text>ç¼–è¾‘ç”¨è¯è®°å½•</text>
      </view>
      <view class="modal-body">
        <view class="form-item">
          <text class="label">è¯ç‰©åç§°</text>
          <view class="medication-name-display">{{editingMedication.medicationName}}</view>
        </view>
        <view class="form-item">
          <text class="label">ç”¨è¯å‰‚é‡</text>
          <view class="dosage-input-container">
            <input type="digit" value="{{editingMedication.dosage}}" data-field="dosage" bindinput="onEditMedicationInput" placeholder="è¯·è¾“å…¥å‰‚é‡" class="dosage-input" />
            <text class="unit-text">{{editingMedication.unit}}</text>
          </view>
        </view>
        <view class="form-item">
          <text class="label">ç”¨è¯æ—¶é—´</text>
          <picker mode="time" value="{{editingMedication.actualTime}}" data-field="actualTime" bindchange="onEditMedicationTimeChange">
            <view class="time-picker">{{editingMedication.actualTime}}</view>
          </picker>
        </view>
      </view>
      <view class="modal-footer">
        <button class="modal-btn cancel" bindtap="hideEditMedicationModal">å–æ¶ˆ</button>
        <button class="modal-btn confirm" bindtap="saveEditedMedication">ä¿å­˜</button>
      </view>
    </view>
  </view>
  <!-- è¡¥å……æ’ä¾¿è®°å½•å¼¹çª— -->
  <view class="modal" wx:if="{{showAddBowelModal}}" bindtap="hideAddBowelModal" catchtouchmove="preventBubble">
    <view class="modal-content" catchtap="preventBubble">
      <view class="modal-header">
        <text>è¡¥å……æ’ä¾¿è®°å½•</text>
      </view>
      <scroll-view class="modal-body" scroll-y="true" enhanced="true" show-scrollbar="false">
        <!-- æ—¶é—´é€‰æ‹© -->
        <view class="form-item">
          <text class="label">æ—¶é—´</text>
          <picker mode="time" value="{{newBowelRecord.time}}" bindchange="onNewBowelTimeChange">
            <view class="time-picker">{{newBowelRecord.time}}</view>
          </picker>
        </view>
        <!-- ç±»å‹é€‰æ‹© -->
        <view class="form-item">
          <text class="label">ç±»å‹</text>
          <view class="bowel-type-options">
            <view class="bowel-type-btn {{newBowelRecord.type === 'stool' ? 'active' : ''}}" data-type="stool" bindtap="onBowelTypeSelect">
              <text class="type-icon">ğŸ’©</text>
              <text class="type-text">å¤§ä¾¿</text>
            </view>
            <view class="bowel-type-btn {{newBowelRecord.type === 'urine' ? 'active' : ''}}" data-type="urine" bindtap="onBowelTypeSelect">
              <text class="type-icon">ğŸ’§</text>
              <text class="type-text">å°ä¾¿</text>
            </view>
            <view class="bowel-type-btn {{newBowelRecord.type === 'mixed' ? 'active' : ''}}" data-type="mixed" bindtap="onBowelTypeSelect">
              <text class="type-icon">ğŸš½</text>
              <text class="type-text">æ··åˆ</text>
            </view>
          </view>
        </view>
        <!-- å¤§ä¾¿è¯¦ç»†ä¿¡æ¯ -->
        <view wx:if="{{newBowelRecord.type === 'stool' || newBowelRecord.type === 'mixed'}}">
          <!-- æ€§çŠ¶ -->
          <view class="form-item">
            <text class="label">æ€§çŠ¶</text>
            <view class="option-grid">
              <view class="option-btn {{newBowelRecord.consistency === 'liquid' ? 'active' : ''}}" data-field="consistency" data-value="liquid" bindtap="onBowelOptionSelect">
                æ°´æ ·
              </view>
              <view class="option-btn {{newBowelRecord.consistency === 'loose' ? 'active' : ''}}" data-field="consistency" data-value="loose" bindtap="onBowelOptionSelect">
                ç¨€ä¾¿
              </view>
              <view class="option-btn {{newBowelRecord.consistency === 'soft' ? 'active' : ''}}" data-field="consistency" data-value="soft" bindtap="onBowelOptionSelect">
                ç³ŠçŠ¶
              </view>
              <view class="option-btn {{newBowelRecord.consistency === 'normal' ? 'active' : ''}}" data-field="consistency" data-value="normal" bindtap="onBowelOptionSelect">
                æ­£å¸¸
              </view>
              <view class="option-btn {{newBowelRecord.consistency === 'hard' ? 'active' : ''}}" data-field="consistency" data-value="hard" bindtap="onBowelOptionSelect">
                å¹²ç¡¬
              </view>
            </view>
          </view>
          <!-- é¢œè‰² -->
          <view class="form-item">
            <text class="label">é¢œè‰²</text>
            <view class="option-grid">
              <view class="option-btn {{newBowelRecord.color === 'yellow' ? 'active' : ''}}" data-field="color" data-value="yellow" bindtap="onBowelOptionSelect">
                é»„è‰²
              </view>
              <view class="option-btn {{newBowelRecord.color === 'green' ? 'active' : ''}}" data-field="color" data-value="green" bindtap="onBowelOptionSelect">
                ç»¿è‰²
              </view>
              <view class="option-btn {{newBowelRecord.color === 'brown' ? 'active' : ''}}" data-field="color" data-value="brown" bindtap="onBowelOptionSelect">
                è¤è‰²
              </view>
              <view class="option-btn {{newBowelRecord.color === 'white' ? 'active' : ''}}" data-field="color" data-value="white" bindtap="onBowelOptionSelect">
                ç™½è‰²
              </view>
              <view class="option-btn {{newBowelRecord.color === 'red' ? 'active' : ''}}" data-field="color" data-value="red" bindtap="onBowelOptionSelect">
                çº¢è‰²
              </view>
              <view class="option-btn {{newBowelRecord.color === 'black' ? 'active' : ''}}" data-field="color" data-value="black" bindtap="onBowelOptionSelect">
                é»‘è‰²
              </view>
            </view>
          </view>
          <!-- æ°”å‘³ -->
          <view class="form-item">
            <text class="label">æ°”å‘³</text>
            <view class="option-grid">
              <view class="option-btn {{newBowelRecord.smell === 'normal' ? 'active' : ''}}" data-field="smell" data-value="normal" bindtap="onBowelOptionSelect">
                æ­£å¸¸
              </view>
              <view class="option-btn {{newBowelRecord.smell === 'sour' ? 'active' : ''}}" data-field="smell" data-value="sour" bindtap="onBowelOptionSelect">
                é…¸è‡­
              </view>
              <view class="option-btn {{newBowelRecord.smell === 'fishy' ? 'active' : ''}}" data-field="smell" data-value="fishy" bindtap="onBowelOptionSelect">
                è…¥è‡­
              </view>
              <view class="option-btn {{newBowelRecord.smell === 'odorless' ? 'active' : ''}}" data-field="smell" data-value="odorless" bindtap="onBowelOptionSelect">
                æ— å‘³
              </view>
            </view>
          </view>
          <!-- åˆ†é‡ -->
          <view class="form-item">
            <text class="label">åˆ†é‡</text>
            <view class="option-grid">
              <view class="option-btn {{newBowelRecord.amount === 'small' ? 'active' : ''}}" data-field="amount" data-value="small" bindtap="onBowelOptionSelect">
                å°‘é‡
              </view>
              <view class="option-btn {{newBowelRecord.amount === 'medium' ? 'active' : ''}}" data-field="amount" data-value="medium" bindtap="onBowelOptionSelect">
                é€‚é‡
              </view>
              <view class="option-btn {{newBowelRecord.amount === 'large' ? 'active' : ''}}" data-field="amount" data-value="large" bindtap="onBowelOptionSelect">
                å¤§é‡
              </view>
            </view>
          </view>
        </view>
        <!-- å¤‡æ³¨ -->
        <view class="form-item">
          <text class="label">å¤‡æ³¨</text>
          <textarea value="{{newBowelRecord.notes}}" data-field="notes" bindinput="onNewBowelInput" placeholder="å¯é€‰ï¼Œè®°å½•å…¶ä»–ä¿¡æ¯" class="notes-textarea" />
        </view>
      </scroll-view>
      <view class="modal-footer">
        <button class="modal-btn cancel" bindtap="hideAddBowelModal">å–æ¶ˆ</button>
        <button class="modal-btn confirm" bindtap="saveNewBowelRecord">ä¿å­˜</button>
      </view>
    </view>
  </view>
  <!-- ç¼–è¾‘æ’ä¾¿è®°å½•å¼¹çª— -->
  <view class="modal" wx:if="{{showEditBowelModal}}" bindtap="hideEditBowelModal" catchtouchmove="preventBubble">
    <view class="modal-content" catchtap="preventBubble">
      <view class="modal-header">
        <text>ç¼–è¾‘æ’ä¾¿è®°å½•</text>
      </view>
      <scroll-view class="modal-body" scroll-y="true" enhanced="true" show-scrollbar="false">
        <!-- æ—¶é—´é€‰æ‹© -->
        <view class="form-item">
          <text class="label">æ—¶é—´</text>
          <picker mode="time" value="{{editingBowelRecord.timeString}}" bindchange="onEditBowelTimeChange">
            <view class="time-picker">{{editingBowelRecord.timeString}}</view>
          </picker>
        </view>
        <!-- ç±»å‹é€‰æ‹© -->
        <view class="form-item">
          <text class="label">ç±»å‹</text>
          <view class="bowel-type-options">
            <view class="bowel-type-btn {{editingBowelRecord.type === 'stool' ? 'active' : ''}}" data-type="stool" bindtap="onEditBowelTypeSelect">
              <text class="type-icon">ğŸ’©</text>
              <text class="type-text">å¤§ä¾¿</text>
            </view>
            <view class="bowel-type-btn {{editingBowelRecord.type === 'urine' ? 'active' : ''}}" data-type="urine" bindtap="onEditBowelTypeSelect">
              <text class="type-icon">ğŸ’§</text>
              <text class="type-text">å°ä¾¿</text>
            </view>
            <view class="bowel-type-btn {{editingBowelRecord.type === 'mixed' ? 'active' : ''}}" data-type="mixed" bindtap="onEditBowelTypeSelect">
              <text class="type-icon">ğŸš½</text>
              <text class="type-text">æ··åˆ</text>
            </view>
          </view>
        </view>
        <!-- å¤§ä¾¿è¯¦ç»†ä¿¡æ¯ -->
        <view wx:if="{{editingBowelRecord.type === 'stool' || editingBowelRecord.type === 'mixed'}}">
          <!-- æ€§çŠ¶ -->
          <view class="form-item">
            <text class="label">æ€§çŠ¶</text>
            <view class="option-grid">
              <view class="option-btn {{editingBowelRecord.consistency === 'liquid' ? 'active' : ''}}" data-field="consistency" data-value="liquid" bindtap="onEditBowelOptionSelect">
                æ°´æ ·
              </view>
              <view class="option-btn {{editingBowelRecord.consistency === 'loose' ? 'active' : ''}}" data-field="consistency" data-value="loose" bindtap="onEditBowelOptionSelect">
                ç¨€ä¾¿
              </view>
              <view class="option-btn {{editingBowelRecord.consistency === 'soft' ? 'active' : ''}}" data-field="consistency" data-value="soft" bindtap="onEditBowelOptionSelect">
                ç³ŠçŠ¶
              </view>
              <view class="option-btn {{editingBowelRecord.consistency === 'normal' ? 'active' : ''}}" data-field="consistency" data-value="normal" bindtap="onEditBowelOptionSelect">
                æ­£å¸¸
              </view>
              <view class="option-btn {{editingBowelRecord.consistency === 'hard' ? 'active' : ''}}" data-field="consistency" data-value="hard" bindtap="onEditBowelOptionSelect">
                å¹²ç¡¬
              </view>
            </view>
          </view>
          <!-- é¢œè‰² -->
          <view class="form-item">
            <text class="label">é¢œè‰²</text>
            <view class="option-grid">
              <view class="option-btn {{editingBowelRecord.color === 'yellow' ? 'active' : ''}}" data-field="color" data-value="yellow" bindtap="onEditBowelOptionSelect">
                é»„è‰²
              </view>
              <view class="option-btn {{editingBowelRecord.color === 'green' ? 'active' : ''}}" data-field="color" data-value="green" bindtap="onEditBowelOptionSelect">
                ç»¿è‰²
              </view>
              <view class="option-btn {{editingBowelRecord.color === 'brown' ? 'active' : ''}}" data-field="color" data-value="brown" bindtap="onEditBowelOptionSelect">
                è¤è‰²
              </view>
              <view class="option-btn {{editingBowelRecord.color === 'white' ? 'active' : ''}}" data-field="color" data-value="white" bindtap="onEditBowelOptionSelect">
                ç™½è‰²
              </view>
              <view class="option-btn {{editingBowelRecord.color === 'red' ? 'active' : ''}}" data-field="color" data-value="red" bindtap="onEditBowelOptionSelect">
                çº¢è‰²
              </view>
              <view class="option-btn {{editingBowelRecord.color === 'black' ? 'active' : ''}}" data-field="color" data-value="black" bindtap="onEditBowelOptionSelect">
                é»‘è‰²
              </view>
            </view>
          </view>
          <!-- æ°”å‘³ -->
          <view class="form-item">
            <text class="label">æ°”å‘³</text>
            <view class="option-grid">
              <view class="option-btn {{editingBowelRecord.smell === 'normal' ? 'active' : ''}}" data-field="smell" data-value="normal" bindtap="onEditBowelOptionSelect">
                æ­£å¸¸
              </view>
              <view class="option-btn {{editingBowelRecord.smell === 'sour' ? 'active' : ''}}" data-field="smell" data-value="sour" bindtap="onEditBowelOptionSelect">
                é…¸è‡­
              </view>
              <view class="option-btn {{editingBowelRecord.smell === 'fishy' ? 'active' : ''}}" data-field="smell" data-value="fishy" bindtap="onEditBowelOptionSelect">
                è…¥è‡­
              </view>
              <view class="option-btn {{editingBowelRecord.smell === 'odorless' ? 'active' : ''}}" data-field="smell" data-value="odorless" bindtap="onEditBowelOptionSelect">
                æ— å‘³
              </view>
            </view>
          </view>
          <!-- åˆ†é‡ -->
          <view class="form-item">
            <text class="label">åˆ†é‡</text>
            <view class="option-grid">
              <view class="option-btn {{editingBowelRecord.amount === 'small' ? 'active' : ''}}" data-field="amount" data-value="small" bindtap="onEditBowelOptionSelect">
                å°‘é‡
              </view>
              <view class="option-btn {{editingBowelRecord.amount === 'medium' ? 'active' : ''}}" data-field="amount" data-value="medium" bindtap="onEditBowelOptionSelect">
                é€‚é‡
              </view>
              <view class="option-btn {{editingBowelRecord.amount === 'large' ? 'active' : ''}}" data-field="amount" data-value="large" bindtap="onEditBowelOptionSelect">
                å¤§é‡
              </view>
            </view>
          </view>
        </view>
        <!-- å¤‡æ³¨ -->
        <view class="form-item">
          <text class="label">å¤‡æ³¨</text>
          <textarea value="{{editingBowelRecord.notes}}" data-field="notes" bindinput="onEditBowelInput" placeholder="å¯é€‰ï¼Œè®°å½•å…¶ä»–ä¿¡æ¯" class="notes-textarea" />
        </view>
      </scroll-view>
      <view class="modal-footer">
        <button class="modal-btn cancel" bindtap="hideEditBowelModal">å–æ¶ˆ</button>
        <button class="modal-btn confirm" bindtap="saveEditedBowelRecord">ä¿å­˜</button>
      </view>
    </view>
  </view>
</view>
