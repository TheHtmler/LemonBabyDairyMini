<!--pages/add-report/index.wxml-->
<view class="container">
  <!-- é¡µé¢å¤´éƒ¨ -->
  <!-- <view class="page-header">
    <text class="page-title">{{mode === 'edit' ? 'ç¼–è¾‘' : 'æ·»åŠ '}}æ£€æµ‹æŠ¥å‘Š</text>
    <text class="page-subtitle">è¯·å‡†ç¡®å¡«å†™å„é¡¹æŒ‡æ ‡æ•°æ®</text>
  </view> -->

  <!-- åŠ è½½çŠ¶æ€ -->
  <view wx:if="{{loading}}" class="loading-container">
    <view class="loading-spinner"></view>
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>

  <!-- ä¸»è¦å†…å®¹ -->
  <view wx:else class="content">
    <!-- åŸºç¡€ä¿¡æ¯å¡ç‰‡ -->
    <view class="base-info-card">
      <view class="info-item">
        <text class="info-label">æ£€æµ‹æ—¥æœŸ</text>
        <picker mode="date" value="{{reportDate}}" bindchange="onDateChange" class="date-picker">
          <view class="picker-content">
            <text class="date-text">{{reportDate || 'è¯·é€‰æ‹©æ—¥æœŸ'}}</text>
            <text class="picker-arrow">ğŸ“…</text>
          </view>
        </picker>
      </view>
    </view>

    <!-- æŠ¥å‘Šç±»å‹é€‰æ‹© -->
    <view class="report-type-section">
      <text class="section-title">æŠ¥å‘Šç±»å‹</text>
      <scroll-view class="type-scroll" scroll-x="true" show-scrollbar="false">
        <view wx:for="{{reportTypes}}" wx:key="key" 
              class="type-item {{selectedReportType === item.key ? 'active' : ''}}"
              bindtap="onReportTypeChange" data-type="{{item.key}}">
          <text class="type-icon">{{item.icon}}</text>
          <text class="type-name">{{item.name}}</text>
        </view>
      </scroll-view>
    </view>

    <!-- æŒ‡æ ‡è¾“å…¥åŒºåŸŸ -->
    <view class="indicators-section">
      <text class="section-title">æŒ‡æ ‡æ•°æ®</text>
      
      <view class="indicators-list">
        <view wx:for="{{currentIndicators}}" wx:key="key" class="indicator-item">
          <!-- æŒ‡æ ‡å¤´éƒ¨ -->
          <view class="indicator-header">
            <view class="indicator-name">
              <text class="name-text">{{item.name}}</text>
              <text class="abbr-text">({{item.abbr}})</text>
              <text wx:if="{{!item.optional && !item.isRatio}}" class="required-mark">*</text>
            </view>
            <view wx:if="{{indicatorData[item.key] && indicatorData[item.key].status}}" 
                  class="status-badge {{indicatorData[item.key].status}}">
                {{indicatorData[item.key].status === 'normal' ? 'æ­£å¸¸' : 
                  indicatorData[item.key].status === 'high' ? 'åé«˜' : 
                  indicatorData[item.key].status === 'low' ? 'åä½' : 'æœªçŸ¥'}}
            </view>
          </view>

          <!-- æŒ‡æ ‡è¾“å…¥ -->
          <view class="indicator-inputs">
            <!-- æ£€æµ‹å€¼ -->
            <view class="input-group">
              <text class="input-label">æ£€æµ‹å€¼</text>
              <input class="input-field" 
                     type="digit" 
                     placeholder="è¯·è¾“å…¥æ£€æµ‹å€¼"
                     value="{{indicatorData[item.key].value}}"
                     data-indicator="{{item.key}}" 
                     data-field="value"
                     bindinput="onIndicatorValueInput"
                     bindblur="onIndicatorValueBlur" />

            </view>

            <!-- å‚è€ƒèŒƒå›´ï¼ˆéæ¯”å€¼æŒ‡æ ‡æˆ–å…è®¸èŒƒå›´è¾“å…¥çš„æ¯”å€¼æŒ‡æ ‡ï¼‰ -->
            <view wx:if="{{!item.isRatio || item.allowRangeInput}}" class="range-inputs">
              <view class="input-group half">
                <text class="input-label">æœ€å°å€¼</text>
                <input class="input-field" 
                       type="digit" 
                       placeholder="{{indicatorData[item.key].minRange ? 'å·²è‡ªåŠ¨å¡«å……' : 'æœ€å°å€¼'}}"
                       value="{{indicatorData[item.key].minRange}}"
                       data-indicator="{{item.key}}" 
                       data-field="minRange"
                       bindinput="onIndicatorValueInput"
                       bindblur="onIndicatorValueBlur" />
              </view>
              <text class="range-separator">-</text>
              <view class="input-group half">
                <text class="input-label">æœ€å¤§å€¼</text>
                <input class="input-field" 
                       type="digit" 
                       placeholder="{{indicatorData[item.key].maxRange ? 'å·²è‡ªåŠ¨å¡«å……' : 'æœ€å¤§å€¼'}}"
                       value="{{indicatorData[item.key].maxRange}}"
                       data-indicator="{{item.key}}" 
                       data-field="maxRange"
                       bindinput="onIndicatorValueInput"
                       bindblur="onIndicatorValueBlur" />
              </view>
            </view>

            <!-- æœ€ä¼˜èŒƒå›´æç¤ºï¼ˆæ°¨åŸºé…¸æŒ‡æ ‡ï¼‰ -->
            <view wx:if="{{indicatorData[item.key].optimalRange}}" class="optimal-range">
              <text class="optimal-label">æœ€ä¼˜èŒƒå›´ï¼š</text>
              <text class="optimal-value">
                {{indicatorData[item.key].optimalRange.min}} - {{indicatorData[item.key].optimalRange.max}}
              </text>
            </view>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- åº•éƒ¨æ“ä½œåŒºåŸŸ -->
  <view class="bottom-section">
    <!-- å…è´£å£°æ˜ -->
    <view class="disclaimer">
      <text class="disclaimer-text">
        âš ï¸ å£°æ˜ï¼šæœ¬å·¥å…·ä»…ç”¨äºè®°å½•æ£€æµ‹æ•°æ®ï¼Œä¸æä¾›åŒ»ç–—è¯Šæ–­å»ºè®®ã€‚è¯·åœ¨ä¸“ä¸šåŒ»ç”ŸæŒ‡å¯¼ä¸‹è§£è¯»æŠ¥å‘Šç»“æœã€‚
      </text>
    </view>

    <!-- ä¿å­˜æŒ‰é’® -->
    <view class="save-section">
      <button class="save-button" bindtap="onSaveReport" disabled="{{saving}}">
        <text class="save-text">{{saving ? 'ä¿å­˜ä¸­...' : 'ä¿å­˜æŠ¥å‘Š'}}</text>
      </button>
    </view>
  </view>
</view> 